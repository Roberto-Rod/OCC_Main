<?xml version="1.0" encoding="utf-8"?>
<EntityFile xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Rules>
    <TraceableEntityType>
      <EntityType>Requirement</EntityType>
      <Rules>
        <TraceableEntityRule>
          <TargetEntityType>Test</TargetEntityType>
          <Linkage>Document TestPlugin</Linkage>
        </TraceableEntityRule>
        <TraceableEntityRule>
          <TargetEntityType>Design</TargetEntityType>
          <Linkage>Document</Linkage>
        </TraceableEntityRule>
      </Rules>
    </TraceableEntityType>
    <TraceableEntityType>
      <EntityType>Design</EntityType>
      <Rules>
        <TraceableEntityRule>
          <TargetEntityType>Test</TargetEntityType>
          <Linkage>Document TestPlugin</Linkage>
        </TraceableEntityRule>
      </Rules>
    </TraceableEntityType>
    <TraceableEntityType>
      <EntityType>Test</EntityType>
      <Rules />
    </TraceableEntityType>
    <TraceableEntityType>
      <EntityType>Hazard</EntityType>
      <Rules />
    </TraceableEntityType>
    <TraceableEntityType>
      <EntityType>Quality</EntityType>
      <Rules />
    </TraceableEntityType>
  </Rules>
  <BarSeparator>true</BarSeparator>
  <MasterSource>
    <Label>All Traceable Entities</Label>
    <Version />
    <ReadOnly>false</ReadOnly>
    <Sources>
      <EntitySource>
        <Label>Eton Firmware Software Requirements Specification v3</Label>
        <Version />
        <ReadOnly>false</ReadOnly>
        <Sources>
          <EntitySource>
            <Label>Hardware Interfaces</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>User Interface output</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>User interface input</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Battery Control</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Pump Control</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Memory Control</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Filtering</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Pressure/Temperature</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>Functional Requirements</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Activation/Deactivation (Standby)</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Delivery of therapy</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources>
                  <EntitySource>
                    <Label>Target Pressure</Label>
                    <Version />
                    <ReadOnly>false</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>Pump down</Label>
                    <Version />
                    <ReadOnly>false</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>Monitor State</Label>
                    <Version />
                    <ReadOnly>false</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>Fault State</Label>
                    <Version />
                    <ReadOnly>false</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>Pause</Label>
                    <Version />
                    <ReadOnly>false</ReadOnly>
                    <Sources />
                  </EntitySource>
                </Sources>
              </EntitySource>
              <EntitySource>
                <Label>Non Recoverable Error</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>Battery management</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
              <EntitySource>
                <Label>End of life management</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>Safety Requirements</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Product Lifecycle Sustainment</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
        </Sources>
      </EntitySource>
      <EntitySource>
        <Label>Eton Firmware - User Interface Requirement Specification v3.</Label>
        <Version />
        <ReadOnly>false</ReadOnly>
        <Sources>
          <EntitySource>
            <Label>Standby</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Indicate Activate</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Pump Down</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Indicate Success</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Monitor</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Indicate Fail</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Fault</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Indicate Status</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>Indicate Deactivate</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
          <EntitySource>
            <Label>NRE</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources />
          </EntitySource>
        </Sources>
      </EntitySource>
      <EntitySource>
        <Label>Test</Label>
        <Version />
        <ReadOnly>false</ReadOnly>
        <Sources>
          <EntitySource>
            <Label>SOTST001 Eton Firmware - Manual Test Specification</Label>
            <Version>B</Version>
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Testing User and Pump Interface</Label>
                <Version />
                <ReadOnly>true</ReadOnly>
                <Sources>
                  <EntitySource>
                    <Label>Test Cases – State Transition</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                </Sources>
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>SOTST001 Eton Firmware - Manual Tests - Additional</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Testing User and Pump Interface</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources>
                  <EntitySource>
                    <Label>Test Cases-Hardware</Label>
                    <Version />
                    <ReadOnly>false</ReadOnly>
                    <Sources />
                  </EntitySource>
                </Sources>
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>SOTST002 Eton Firmware - Unit Test Specification</Label>
            <Version>B_02</Version>
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>List of Unit Tests</Label>
                <Version />
                <ReadOnly>true</ReadOnly>
                <Sources>
                  <EntitySource>
                    <Label>Tagging for Trace Matrix</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                </Sources>
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>SOTST003 Eton Firmware Automated Test Specification</Label>
            <Version>A_01</Version>
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Automated Tests</Label>
                <Version />
                <ReadOnly>true</ReadOnly>
                <Sources />
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>SOTST003 Eton Firware Automated Tests</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Automated Tests</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
            </Sources>
          </EntitySource>
        </Sources>
      </EntitySource>
      <EntitySource>
        <Label>Design</Label>
        <Version />
        <ReadOnly>false</ReadOnly>
        <Sources>
          <EntitySource>
            <Label>SODSN002 Eton Firmware Software Design Specification</Label>
            <Version>B_03</Version>
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>UNIT DESCRIPTION</Label>
                <Version />
                <ReadOnly>true</ReadOnly>
                <Sources>
                  <EntitySource>
                    <Label>APPLICATION</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>Managers</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>DEVICES</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>HARDWARE ABSTRACTION CUSTOM FILES</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                  <EntitySource>
                    <Label>HARDWARE ABSTRACTION- AUTO GENERATED FILES</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                </Sources>
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>SODSN001 Eton Firmware - Software Architecture Document</Label>
            <Version>B_03</Version>
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Device Overview</Label>
                <Version />
                <ReadOnly>true</ReadOnly>
                <Sources>
                  <EntitySource>
                    <Label>A.1 Application Layer</Label>
                    <Version />
                    <ReadOnly>true</ReadOnly>
                    <Sources />
                  </EntitySource>
                </Sources>
              </EntitySource>
            </Sources>
          </EntitySource>
          <EntitySource>
            <Label>SODSN001 - PumpDown</Label>
            <Version />
            <ReadOnly>false</ReadOnly>
            <Sources>
              <EntitySource>
                <Label>Pump Down State</Label>
                <Version />
                <ReadOnly>false</ReadOnly>
                <Sources />
              </EntitySource>
            </Sources>
          </EntitySource>
        </Sources>
      </EntitySource>
    </Sources>
  </MasterSource>
  <Entities>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SRS01010</Id>
      <Address />
      <Title>Amber LED</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall have the ability to control the Amber\par
LED indicator.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01010</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|User Interface output</Address>
      <Title>Amber LED</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall have the ability to control the Amber LED indicator.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>LED design</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00010 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix:10 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-44</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00044 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01020</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|User Interface output</Address>
      <Title>Green LED</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall have the ability to control the Green LED indicator.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>LED</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00010 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix:10 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-44</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00044 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01030</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|User interface input</Address>
      <Title>Button Press</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall have the ability to monitor the Button press and differentiate between short and long presses\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix:10 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Provides APIs to set and update the LED status and to detect button presses.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00009 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00020 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-44</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00044 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01040</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Battery Control</Address>
      <Title>Voltage Monitoring</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall interface with the Battery Voltage and Boost Voltage ADC input to acquire their actual voltage.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix:10 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Monitor the status of the battery and adjust the boost converter settings to guarantee a reliable therapy delivery operation and a smooth transition to the device end of life.
Checks the battery and boost converter voltage output are within their working range (i.e.&lt;3.6V and between 16V and 33V respectively). If this is not the case, the module produces a "VOLTAGE OUT OF RANGE" error and this happens, for example, when the pull tab is still in place producing a boost converter voltage output reading lower than 16 V (most likely close to 0 V).
The battery provides an initial output voltage of 3V supporting the boost converter to generate an output voltage of 27V when driving the pump. After usage when the battery voltage goes below a certain level (i.e. 2.2V) the boost converter will not reliably produce its maximum output. As a result this module implements an algorithm to decrease the required boost converter output. This prevents the system from attempting to work in unstable conditions and extends the life of the battery.
Battery Voltage
Boost Converter
Output setting
Conditions
&gt;=2.2V
27V
None
&lt;2.2V
(Previous Output -1V)
Every10 times the battery is detected as &lt;2.2V
&lt;2.2V
&gt;18V
END-OF_LIFE
(EOL)
Table 11, Boost Converter settings table
The module will decrease the requested boost converter output by 1V every time the balance between battery measurements below and above 2.2 V reaches 10. This means that the shortest time for the boost converter output to go from 27 to 18 V (i.e. 9 V) is 90 seconds (i.e. 9 x 10 x 1 second cycle) during Therapy Maintenance state. In reality this will take much longer because the pump is unlikely to be activated every 1s cycle based on the vacuum reading. The illustration of the behaviour is depicted in Figure 7.
Figure 7, Battery life Vs. Boost Converter output settings
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00013 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-34</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00034 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01050</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Battery Control</Address>
      <Title>Boost Voltage Control</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall interface with the Reference Boost\par
Voltage DAC output to set its reference voltage.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix:10 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Monitor the status of the battery and adjust the boost converter settings to guarantee a reliable therapy delivery operation and a smooth transition to the device end of life.
Checks the battery and boost converter voltage output are within their working range (i.e.&lt;3.6V and between 16V and 33V respectively). If this is not the case, the module produces a "VOLTAGE OUT OF RANGE" error and this happens, for example, when the pull tab is still in place producing a boost converter voltage output reading lower than 16 V (most likely close to 0 V).
The battery provides an initial output voltage of 3V supporting the boost converter to generate an output voltage of 27V when driving the pump. After usage when the battery voltage goes below a certain level (i.e. 2.2V) the boost converter will not reliably produce its maximum output. As a result this module implements an algorithm to decrease the required boost converter output. This prevents the system from attempting to work in unstable conditions and extends the life of the battery.
Battery Voltage
Boost Converter
Output setting
Conditions
&gt;=2.2V
27V
None
&lt;2.2V
(Previous Output -1V)
Every10 times the battery is detected as &lt;2.2V
&lt;2.2V
&gt;18V
END-OF_LIFE
(EOL)
Table 11, Boost Converter settings table
The module will decrease the requested boost converter output by 1V every time the balance between battery measurements below and above 2.2 V reaches 10. This means that the shortest time for the boost converter output to go from 27 to 18 V (i.e. 9 V) is 90 seconds (i.e. 9 x 10 x 1 second cycle) during Therapy Maintenance state. In reality this will take much longer because the pump is unlikely to be activated every 1s cycle based on the vacuum reading. The illustration of the behaviour is depicted in Figure 7.
Figure 7, Battery life Vs. Boost Converter output settings
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00013 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-50</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00051 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01060</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Pump Control</Address>
      <Title>Pressure Monitoring</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall interface with the Pressure Sensors\rquote  ADC input to acquire the pressure sensor readings.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence.
Note: This test is also used to start off other tests.
3.2.2.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 1 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Read pressure sensors to determine the current vacuum, decide if this is at target level depending on which state of the therapy delivery (IPD or MPD) the application is in.
Check if a gross leak condition has occurred during therapy maintenance.
Update the target vacuum value during therapy maintenance based on pump duty cycle.
This module consists of a number of sub-modules (e.g. Part 1..4) that abstract the interface with the State Machine from the lower level operations (e.g. I2C) to get and validate the pressure values form the external HW peripherals. This also allows unit testing of business logic independently of HW. (E.g. use of the leak detection output).”
The highest level sub-module (Pressure_Part1.c) is used by the State Machine; the intermediate sub module uses the duty cycle module (DutyCycle.c) for some of its business logic, and the lowest level sub module (e.g. Pressure_Part4.c) interacts with the HW peripherals allocated to the pressure sensors (i2c.c).
The pressure sensor module adopts a number of mechanisms to guarantee valid vacuum readings are produced:
Both internal and external pressure readings must be successful otherwise an error is returned
Each pressure read operation is repeated a number of times in case of unsuccessful acquisition, before returning an error
Internal Temperate Senor
This module also reads the temperature from the internal pressure sensor. The value read is a 16 bit 2’compliment number and is logged in the EEPROM by the Performance logger Manager. In order to calculate the actual temperature in °C the following formulae is used (42.5 - (value/480)).
(See reference [6] for further details
https://www.st.com/content/ccc/resource/technical/document/technical_note/23/dd/08/f8/ac/cf/47/83/DM00242307.pdf/files/DM00242307.pdf/jcr:content/translations/en.DM00242307.pdf for further details)
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00019 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-39</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00039 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01070</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Pump Control</Address>
      <Title>Pump Current Monitoring</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall interface with the Pump Current ADC input to acquire the actual current drawn by the pump when running\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-34</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00034 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01080</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Pump Control</Address>
      <Title>Pump Frequency Control</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall adjust the Frequency of the piezo\par
Pump so that the Pump operates within its efficiency\par
curve.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Enable and disable of the pump by adjusting its PWM configuration. Carry out a number of operations that are needed to guarantee the correct functioning of the device; drive the frequency of the pump piezo towards an optimum working condition, monitor the boost converter voltage and battery voltage outputs when the pump is activated.
This module is used by the Initial Pump Down and Monitor Delivery states of the State Machine and uses a number of device (i.e. Pump Frequency Tracker, Battery) and HW abstraction modules (i.e. Power Control).
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00014 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-50</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00050 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01090</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Pump Control</Address>
      <Title>Pump PWM Control</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall interface with the Pump PWM module output to set the optimal PWM working frequency for the piezo pump when running, and to start\\stop the pump.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Enable and disable of the pump by adjusting its PWM configuration. Carry out a number of operations that are needed to guarantee the correct functioning of the device; drive the frequency of the pump piezo towards an optimum working condition, monitor the boost converter voltage and battery voltage outputs when the pump is activated.
This module is used by the Initial Pump Down and Monitor Delivery states of the State Machine and uses a number of device (i.e. Pump Frequency Tracker, Battery) and HW abstraction modules (i.e. Power Control).
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00014 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-50</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00050 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01100</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Memory Control</Address>
      <Title>EEPROM Interface</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall interface with the EEPROM memory in order to store device performance data.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This module reads and writes data to the EEPROM chip connected to the PIC16LF1509 microprocessor via an I2C bus and it is used by the Performance Logger and POST state modules.
The module's write function writes the desired value to the specified address making sure the value is not stored across 2 consecutive pages (the EEPROM is organised in 256 byte pages).
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00025 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION CUSTOM FILES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-60</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00060 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
Test Sequence
IDLE  Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Pressure Achieved, STATUS (‘Indicate Success’)  MONITOR  Short Button Press  STATUS (‘Indicate Status’)  Long Button Press  STATUS (‘Indicate Deactivate’)  SHUT DOWN  3 second Time-out  IDLE
The above sequence is followed by the sequence below,
Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Long Button Press  STATUS (‘Indicate Deactivate’)  SHUT DOWN  3 second Time-out  IDLE
And that is repeated a further 3 times as shown below.
Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Long Button Press  STATUS (‘Indicate Deactivate’)  SHUT DOWN  3 second Time-out  IDLE
Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Long Button Press  STATUS (‘Indicate Deactivate’)  SHUT DOWN  3 second Time-out  IDLE
Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Long Button Press  STATUS (‘Indicate Deactivate’)  SHUT DOWN  3 second Time-out  IDLE
State change matrix: 1  8  14  10  18  1  4  18  1  4  18  1  4  18  1  4  18
Prerequisites
The Eton Firmware PCBA is in the IDLE state.
‘Power level is good’.
‘Dressing Connected’.
Test Execution
Test Step
Action
Expected Result
To Start a pump down, perform a short press on the OK button.
The pump will come on and start pumping.
The green LED will come on for a second.
For the next 10 seconds repeatedly perform short button presses
Verify that the pump down sequence continues.
Wait for 3 seconds
Verify the pump down sequence completes with a 2 second on phase.
Wait for 1 minute
Verify that no LEDs come on
Now in MONITOR state
To Verify the status works, perform a short press on the OK button.
The green LED will come on for two seconds and goes off.
To Return to the IDLE state, perform a long press on the OK button.
This should take the system back to the idle state.
(The green will flash on due status function when started from MONITOR state)
Verify the green LED comes on for 2 seconds and then goes off again.
The amber LED will come on for 1 second and then goes off
Wait for a minute
Verify that no LEDs come on
Now in IDLE state
To Start a pump down, perform a short press on the OK button.
The pump will come on and start pumping.
The green LED will come on for a second.
Perform a long press on the OK button.
This should take the system back to the idle state.
Verify the green LED comes on for 2 seconds and then goes off again.
The amber LED will come on for 1 second and then goes off
Repeat the last 3 steps 3 times and vary when the long button press is started
Verify the system always returns to the IDLE state
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01110</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Filtering</Address>
      <Title>Analogue input Noise Filtering</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall process the analogue inputs to minimise noise..\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-15</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00015 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Power On Self Tests are run by the test via the UART when the ICT equipment starts the system.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00001 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01120</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Filtering</Address>
      <Title>Digital output Noise Filtering</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall protect the therapy delivery against\par
noise on digital outputs (e.g. LEDs, Pressure Sensor\par
Power, Voltage Boost Power Enable), explicitly setting or clearing them as applicable. It must not merely be left unchanged from the last system tick.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-15</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00015 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01130</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Filtering</Address>
      <Title>Digital input Noise Filtering</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall protect the therapy delivery against\par
noise on digital inputs (e.g. Push Button), using some\par
form of filtering (e.g. debouncing).\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-16</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00016 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00020 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02010</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Activation/Deactivation (Standby)</Address>
      <Title>Activation Alert</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall indicate to the user when the device has been activated by raising a visual alert.\par
\par
Note: Visual alert sequences should conform to the UIRS. \par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-1</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00001 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02020</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Activation/Deactivation (Standby)</Address>
      <Title>Activation via button Press</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall start therapy upon receipt of a BUT_ShortPress whilst in standby mode and pull-tab is removed. \par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00004 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00020 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-1</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00001 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-52</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00052 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02030</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Activation/Deactivation (Standby)</Address>
      <Title>Auto - restart</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall restart therapy after 60 minutes have elapsed since the therapy was paused by the user\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The main operation of the device is governed by the operational therapy state machine as shown in Figure 4. It is responsible for starting/stopping therapy and ensuring that the correct therapy is delivered.
Figure 4, Device operational state machine
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00004 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-1</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00001 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-52</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00052 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02040</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Activation/Deactivation (Standby)</Address>
      <Title>Deactivation Alert</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall indicate to the user when the device has been deactivated by raising a visual alert.\par
\par
Note: Visual alert sequences should conform to the UIRS.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02060</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Target Pressure</Address>
      <Title>Target Pressure Control</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall set the target pressure of -80mmHg\par
within an operating margin of +20% before commencing therapy.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>In order to increase the products tolerance to leaks a system of variable target pressures is also used. This is achieved by monitoring the pump duty cycle, as per the last section see 3.5.7 but over the last 10 seconds. Ideally the application would maintain the vacuum at -107 mBar. However, if the pump duty cycle starts creeping up (without reaching a gross leak level, i.e. &gt;3 activations in the last 10 seconds), the application monitors it every 9 seconds and reduces (in 1mBar steps) the target vacuum so the pump will possibly activate less frequently (i.e. reducing the duty cycle), the battery consumption is preserved, and the therapy is still delivered at an acceptable level. This, for instance, could happen if the overall leak rate of the dressing has increased but only for a short amount of time. This behaviour works in reverse, which means the target vacuum is moved towards the -107 mBar should the pump duty cycle fall below the same threshold.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00016 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-6</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00006 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02070</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pump down</Address>
      <Title>Initial Pump Down (IPD)</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Before entering therapy, the software shall Pump Down the dressing by driving the pump until the actual\par
pressure reaches the target pressure within an operating margin of +20%\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-39</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00039 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02100</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pump down</Address>
      <Title>Indicate Pump Down</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall raise a visual alert upon starting the pump down and remain in pump down state until the visual alert sequence is completed.\par
\par
Note: Visual alert sequences should conform to the UIRS.\par
}
</Description>
      <Notes>Note: Visual alert sequences should conform to the
UIRS.
</Notes>
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-44</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00044 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02120</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pump down</Address>
      <Title>IPD Maximum Period</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall transition to FAULT state after 20 seconds if the target pressure has not been achieved.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00005 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02101</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pump down</Address>
      <Title>Pump Down pressure maintenance</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall maintain target pressure by turning on the pump if the measured pressure is below the Target Pressure while in pump down state.\par
}
</Description>
      <Notes>Note: Visual alert sequences should conform to the
UIRS.</Notes>
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>In order to increase the products tolerance to leaks a system of variable target pressures is also used. This is achieved by monitoring the pump duty cycle, as per the last section see 3.5.7 but over the last 10 seconds. Ideally the application would maintain the vacuum at -107 mBar. However, if the pump duty cycle starts creeping up (without reaching a gross leak level, i.e. &gt;3 activations in the last 10 seconds), the application monitors it every 9 seconds and reduces (in 1mBar steps) the target vacuum so the pump will possibly activate less frequently (i.e. reducing the duty cycle), the battery consumption is preserved, and the therapy is still delivered at an acceptable level. This, for instance, could happen if the overall leak rate of the dressing has increased but only for a short amount of time. This behaviour works in reverse, which means the target vacuum is moved towards the -107 mBar should the pump duty cycle fall below the same threshold.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00016 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02140</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>Start Maintenance Pump Down (MPD)</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall maintain negative pressure by activating the pump until the measured pressure matches the Target Pressure.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>In order to increase the products tolerance to leaks a system of variable target pressures is also used. This is achieved by monitoring the pump duty cycle, as per the last section see 3.5.7 but over the last 10 seconds. Ideally the application would maintain the vacuum at -107 mBar. However, if the pump duty cycle starts creeping up (without reaching a gross leak level, i.e. &gt;3 activations in the last 10 seconds), the application monitors it every 9 seconds and reduces (in 1mBar steps) the target vacuum so the pump will possibly activate less frequently (i.e. reducing the duty cycle), the battery consumption is preserved, and the therapy is still delivered at an acceptable level. This, for instance, could happen if the overall leak rate of the dressing has increased but only for a short amount of time. This behaviour works in reverse, which means the target vacuum is moved towards the -107 mBar should the pump duty cycle fall below the same threshold.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00016 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Calculate the duty cycle between Pump ON and OFF in the Therapy Maintenance state. During each second the pump will come on for 100ms if more pressure is need or stay off if pressure is not needed. The duty cycle is the ratio of the number of on seconds within a fixed period of n readings. This module uses a sliding window to keep track of the most recent pump activity history (e.g. last 32 seconds). That is every second when the vacuum is calculated the sliding window is shifted along and the new record added to the end.
The module also determines which portion of the duty cycle history is used to detect a gross leak condition; too frequent pump activation indicates the presence of a gross leak which the application cannot sustain without depleting the battery prematurely. In this case, if a maximum number of pump activations (i.e. &gt;15) in the defined gross leak detection window (i.e. 30 seconds) occurs, the State Machine will transition into a Fault state giving the user the opportunity to readjust the dressing and possibly resolve the unsustainable leak.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00015 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-6</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00006 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02180</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>Pump Duty Cycle Monitoring</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 During monitor, the software shall calculate the Pump Duty Cycle as the percentage of time the pump is ON in a 30 second period.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Calculate the duty cycle between Pump ON and OFF in the Therapy Maintenance state. During each second the pump will come on for 100ms if more pressure is need or stay off if pressure is not needed. The duty cycle is the ratio of the number of on seconds within a fixed period of n readings. This module uses a sliding window to keep track of the most recent pump activity history (e.g. last 32 seconds). That is every second when the vacuum is calculated the sliding window is shifted along and the new record added to the end.
The module also determines which portion of the duty cycle history is used to detect a gross leak condition; too frequent pump activation indicates the presence of a gross leak which the application cannot sustain without depleting the battery prematurely. In this case, if a maximum number of pump activations (i.e. &gt;15) in the defined gross leak detection window (i.e. 30 seconds) occurs, the State Machine will transition into a Fault state giving the user the opportunity to readjust the dressing and possibly resolve the unsustainable leak.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00015 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-8</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00008 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02190</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>Leak Duty Detection</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall compare duty cycle against the leak duty cycle.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Calculate the duty cycle between Pump ON and OFF in the Therapy Maintenance state. During each second the pump will come on for 100ms if more pressure is need or stay off if pressure is not needed. The duty cycle is the ratio of the number of on seconds within a fixed period of n readings. This module uses a sliding window to keep track of the most recent pump activity history (e.g. last 32 seconds). That is every second when the vacuum is calculated the sliding window is shifted along and the new record added to the end.
The module also determines which portion of the duty cycle history is used to detect a gross leak condition; too frequent pump activation indicates the presence of a gross leak which the application cannot sustain without depleting the battery prematurely. In this case, if a maximum number of pump activations (i.e. &gt;15) in the defined gross leak detection window (i.e. 30 seconds) occurs, the State Machine will transition into a Fault state giving the user the opportunity to readjust the dressing and possibly resolve the unsustainable leak.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00015 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-8</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00008 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02241</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Fault State</Address>
      <Title>Fail Alert</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Upon entering the fault state the software shall raise a visual alert to indicate failure.\par
\par
Note: Visual alert sequences should conform to the UIRS.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00005 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-8</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00008 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02270</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Fault State</Address>
      <Title>Fault Alert Sequence</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 A periodic visual alert shall be raised whilst in Fault state\par
\par
Note: Visual alert sequences should conform to the\par
UIRS.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-8</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00008 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02280</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Fault State</Address>
      <Title>Restart from Fault via Button</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall transition to the pump down state upon receipt of a BUT_ShortPress.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00020 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-51</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00051 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-61</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00061 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02290</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Fault State</Address>
      <Title>Auto Restart from Fault</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall transition to the pump down state after 60 minutes have elapsed.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-51</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00051 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-61</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00061 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02300</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pause</Address>
      <Title>Pause via Button Press</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall transition to standby state upon receipt of a BUT_LongPress whilst in pump down, fault or monitor states. \par
\par
Note: the device is allowed to attempt to restart by actioning short press until long press event is recognised.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-24</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00024 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-37</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00037 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This produces various repeated pump down and pause sequences. This verifies the operation of the application as well as the underlying drivers.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00004 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02350</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pause</Address>
      <Title>Therapy Stop  Alert</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall provide an alert when the therapy delivery is stopped by a BUT_LongPress. \par
\par
Note: Visual alert sequences should conform to the UIRS. \par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-65</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00065 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-67</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00067 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02360</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pause</Address>
      <Title>Therapy Stop  Without Alert </Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall display no visual alert when the therapy delivery is stopped due to the following:\par
\par
- entering the NRE state\par
- entering standby when boost voltage out of bounds\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02370</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Non Recoverable Error</Address>
      <Title>Enter NRE State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall enter a non-recoverable error state\par
on the following events:\par
- An unrecoverable error has occurred (e.g. End Of Life condition, battery depletion)\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-35</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00035 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02371</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Non Recoverable Error</Address>
      <Title>End Of Life</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall stop therapy and enter NRE state after 168 hours have elapsed since first activation.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02390</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>Shelf life prolongation</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall not automatically start delivering\par
therapy when power is applied for the first time in order\par
to guarantee the longest possible shelf life.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-58</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00058 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02400</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>No Start with Pull Tab in Place</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall not deliver therapy if the Button is\par
pressed with the pull tab in place\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Power Consumption Tests
This test will verify the current consumption in a number of different states as described in section 3.4.1.1.
In addition, the test also verifies the UIRS 01040 and UIRS 03050 requirements.
3.4.1.1	Test Sequence
1.	Test Case 1: When the system is powered up but the tab has not been pulled.

Measurement State: IDLE.

2.	Test Case 2: When the system is powered up but the tab has not been pulled and after the button has been pressed.

Measurement State: IDLE.

3.	Test Case 3: Power consumption when the tab has been pulled but before the button is pressed.

Measurement State: IDLE.

4.	Test Case 4: Power consumption when the tab is pulled and monitor state entered and paused.

Measurement State: IDLE.

5.	Test Case 5: Power consumption over a period of time when in the MONITOR state. This test will involve using a digital storage scope to capture current pulses when the pump is on and estimating the current consumed for those pulses over a period of time. (I.e. using the measured current, pulse width and number of pulses to provide an estimate for the overall current consumption).

Measurement State: MONITOR
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00014 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-59</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00059 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02410</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>Power Management</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall minimize power consumption whilst delivering therapy.\par
\par
Note: This is so that in normal operation the batteries\par
shall last up to 7 days\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-6</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00006 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests the timing of the managers within the system do not use more than their allocated time in any one schedule (i.e. 100ms) and also that the processor goes to sleep in unused ticks during therapy. The test monitors that amount of free time available after the processing of one tick and the start of the next tick. This is achieved by simply keeping a loop count in the application of the number of times the tick flag is checked before it becomes active from the low level interrupt. The results are output via the UART port.
To test the power saving function is active a count is used to switched on and off the call to the routine which sleeps to the next tick when the system is in therapy mode. When the power saving is active, the processor will sleep until the next tick occurs and when it is not active there will be a large count as the processor waits </Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00003 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests the timing of the managers within the system do not use more than their allocated time in any one schedule (i.e. 100ms) and also that the processor goes to sleep in unused ticks during therapy. The test monitors that amount of free time available after the processing of one tick and the start of the next tick. This is achieved by simply keeping a loop count in the application of the number of times the tick flag is checked before it becomes active from the low level interrupt. The results are output via the UART port.
To test the power saving function is active a count is used to switched on and off the call to the routine which sleeps to the next tick when the system is in therapy mode. When the power saving is active, the processor will sleep until the next tick occurs and when it is not active there will be a large count as the processor waits </Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00003 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02420</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>NRE Event Detection</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall detect a Depleted Battery \\ End of\par
Life condition (battery voltage less than 2.2V and boost voltage less than 18V while activating the pump) and bring the device into a non-recoverable Error state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Monitor the status of the battery and adjust the boost converter settings to guarantee a reliable therapy delivery operation and a smooth transition to the device end of life.
Checks the battery and boost converter voltage output are within their working range (i.e.&lt;3.6V and between 16V and 33V respectively). If this is not the case, the module produces a "VOLTAGE OUT OF RANGE" error and this happens, for example, when the pull tab is still in place producing a boost converter voltage output reading lower than 16 V (most likely close to 0 V).
The battery provides an initial output voltage of 3V supporting the boost converter to generate an output voltage of 27V when driving the pump. After usage when the battery voltage goes below a certain level (i.e. 2.2V) the boost converter will not reliably produce its maximum output. As a result this module implements an algorithm to decrease the required boost converter output. This prevents the system from attempting to work in unstable conditions and extends the life of the battery.
Battery Voltage
Boost Converter
Output setting
Conditions
&gt;=2.2V
27V
None
&lt;2.2V
(Previous Output -1V)
Every10 times the battery is detected as &lt;2.2V
&lt;2.2V
&gt;18V
END-OF_LIFE
(EOL)
Table 11, Boost Converter settings table
The module will decrease the requested boost converter output by 1V every time the balance between battery measurements below and above 2.2 V reaches 10. This means that the shortest time for the boost converter output to go from 27 to 18 V (i.e. 9 V) is 90 seconds (i.e. 9 x 10 x 1 second cycle) during Therapy Maintenance state. In reality this will take much longer because the pump is unlikely to be activated every 1s cycle based on the vacuum reading. The illustration of the behaviour is depicted in Figure 7.
Figure 7, Battery life Vs. Boost Converter output settings
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00013 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-2</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00002 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-34</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00034 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02430</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>Disable Power to Hardware Peripherals</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall enter a low power state switching off all the HW peripherals apart from the Button whenever the therapy is paused by the user so to allow the battery to last as long as possible\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-7</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00007 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02440</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>Disable Leak Detection when Battery is Low</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 If the software detects that the battery level does not\par
allow the device to operate at optimal conditions (i.e.\par
boost voltage &lt; 27V), it will disable the Leak Detection.\par
Note: In so doing, the device will try its best to maintain the target pressure until reaching the End of Life condition\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-8</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00008 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02460</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|End of life management</Address>
      <Title>Prevent Device Usage in NRE</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall prevent use of the device once the\par
End of Life condition (therapy delivery for a period\par
greater than 7 days or, battery voltage less than 2.2V\par
and boost voltage less than 18V while activating the\par
pump) is detected.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-35</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00035 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02470</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|End of life management</Address>
      <Title>No Visual Alerts in NRE</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall turn off any visual alert when after\par
detecting the End Of Life condition or any other nonrecoverable error.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-35</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00035 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test runs the test harness and then causes a hang via a SCU when the pump is active. The system should reset. The following SCUs are added to the system:-
•	Cause an infinite loop when pumping is active. 
•	Verify the Assert kicks in and causes the system to reset.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00005 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02540</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Safety Requirements</Address>
      <Title>Watchdog Enable</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall use an internal watchdog to protect\par
the device from system failures\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)


</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The internal watchdog of the PIC16LF1509 MCU is used by this module, and is configured via the MPLAB MCC. The module is implemented in Watchdog.c and Watchdog.h, and provides a function to initialise the watchdog and another to kick it. The module initialises the watchdog to have a timeout of 512ms. An advisory note for Debug builds, it was found that the watchdog did not function correctly when the MCU was in debug mode (since halting at a breakpoint would cause the MCU to reset), therefore this module mustn't be compiled in when the software is built in debug mode with the intent of using software breakpoints.
The watchdog initialisation routine is called at the start of the initialisation routine for the application. This ensures that any failure when initialising the other software modules will be caught by the watchdog.
The watchdog kick routine is called at the end of every 100ms system cycle. In deep sleep the watchdog is disabled.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00003 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test verifies that the Log Buffer can be cleared correctly to its default state. It tests the write function to the EEPROM and also that that watchdog will reset processor if it is not kicked.
Note: This test is run as parts of the other tests to bring the log buffer into a known state. This is necessary to ensure that variables are always 0xFF as the application assumes this when writing to the device as the SLEEP mode is achieved by simply incrementing the EEPROM address count. Also it is not possible to know where any previous test stopped writing to the buffer.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00008 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02541</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Safety Requirements</Address>
      <Title>Negative Pressure Limit</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall prevent the device from reaching an unsafe vacuum level.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Read pressure sensors to determine the current vacuum, decide if this is at target level depending on which state of the therapy delivery (IPD or MPD) the application is in.
Check if a gross leak condition has occurred during therapy maintenance.
Update the target vacuum value during therapy maintenance based on pump duty cycle.
This module consists of a number of sub-modules (e.g. Part 1..4) that abstract the interface with the State Machine from the lower level operations (e.g. I2C) to get and validate the pressure values form the external HW peripherals. This also allows unit testing of business logic independently of HW. (E.g. use of the leak detection output).”
The highest level sub-module (Pressure_Part1.c) is used by the State Machine; the intermediate sub module uses the duty cycle module (DutyCycle.c) for some of its business logic, and the lowest level sub module (e.g. Pressure_Part4.c) interacts with the HW peripherals allocated to the pressure sensors (i2c.c).
The pressure sensor module adopts a number of mechanisms to guarantee valid vacuum readings are produced:
Both internal and external pressure readings must be successful otherwise an error is returned
Each pressure read operation is repeated a number of times in case of unsuccessful acquisition, before returning an error
Internal Temperate Senor
This module also reads the temperature from the internal pressure sensor. The value read is a 16 bit 2’compliment number and is logged in the EEPROM by the Performance logger Manager. In order to calculate the actual temperature in °C the following formulae is used (42.5 - (value/480)).
(See reference [6] for further details
https://www.st.com/content/ccc/resource/technical/document/technical_note/23/dd/08/f8/ac/cf/47/83/DM00242307.pdf/files/DM00242307.pdf/jcr:content/translations/en.DM00242307.pdf for further details)
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00019 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02542</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Safety Requirements</Address>
      <Title>Measurement Error Handling</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall stop delivering therapy if a reliable\par
reading of the actual negative pressure cannot be taken.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-82</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00082 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Read pressure sensors to determine the current vacuum, decide if this is at target level depending on which state of the therapy delivery (IPD or MPD) the application is in.
Check if a gross leak condition has occurred during therapy maintenance.
Update the target vacuum value during therapy maintenance based on pump duty cycle.
This module consists of a number of sub-modules (e.g. Part 1..4) that abstract the interface with the State Machine from the lower level operations (e.g. I2C) to get and validate the pressure values form the external HW peripherals. This also allows unit testing of business logic independently of HW. (E.g. use of the leak detection output).”
The highest level sub-module (Pressure_Part1.c) is used by the State Machine; the intermediate sub module uses the duty cycle module (DutyCycle.c) for some of its business logic, and the lowest level sub module (e.g. Pressure_Part4.c) interacts with the HW peripherals allocated to the pressure sensors (i2c.c).
The pressure sensor module adopts a number of mechanisms to guarantee valid vacuum readings are produced:
Both internal and external pressure readings must be successful otherwise an error is returned
Each pressure read operation is repeated a number of times in case of unsuccessful acquisition, before returning an error
Internal Temperate Senor
This module also reads the temperature from the internal pressure sensor. The value read is a 16 bit 2’compliment number and is logged in the EEPROM by the Performance logger Manager. In order to calculate the actual temperature in °C the following formulae is used (42.5 - (value/480)).
(See reference [6] for further details
https://www.st.com/content/ccc/resource/technical/document/technical_note/23/dd/08/f8/ac/cf/47/83/DM00242307.pdf/files/DM00242307.pdf/jcr:content/translations/en.DM00242307.pdf for further details)
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00019 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test runs the test harness and then causes a hang via a SCU when the pump is active. The system should reset. The following SCUs are added to the system:-
•	Cause an infinite loop when pumping is active. 
•	Verify the Assert kicks in and causes the system to reset..</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00005 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02543</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Safety Requirements</Address>
      <Title>Voltage Out of Range</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall stop therapy and enter standby if\par
voltage out of range occurs\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-59</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00059 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Monitor the status of the battery and adjust the boost converter settings to guarantee a reliable therapy delivery operation and a smooth transition to the device end of life.
Checks the battery and boost converter voltage output are within their working range (i.e.&lt;3.6V and between 16V and 33V respectively). If this is not the case, the module produces a "VOLTAGE OUT OF RANGE" error and this happens, for example, when the pull tab is still in place producing a boost converter voltage output reading lower than 16 V (most likely close to 0 V).
The battery provides an initial output voltage of 3V supporting the boost converter to generate an output voltage of 27V when driving the pump. After usage when the battery voltage goes below a certain level (i.e. 2.2V) the boost converter will not reliably produce its maximum output. As a result this module implements an algorithm to decrease the required boost converter output. This prevents the system from attempting to work in unstable conditions and extends the life of the battery.
Battery Voltage
Boost Converter
Output setting
Conditions
&gt;=2.2V
27V
None
&lt;2.2V
(Previous Output -1V)
Every10 times the battery is detected as &lt;2.2V
&lt;2.2V
&gt;18V
END-OF_LIFE
(EOL)
Table 11, Boost Converter settings table
The module will decrease the requested boost converter output by 1V every time the balance between battery measurements below and above 2.2 V reaches 10. This means that the shortest time for the boost converter output to go from 27 to 18 V (i.e. 9 V) is 90 seconds (i.e. 9 x 10 x 1 second cycle) during Therapy Maintenance state. In reality this will take much longer because the pump is unlikely to be activated every 1s cycle based on the vacuum reading. The illustration of the behaviour is depicted in Figure 7.
Figure 7, Battery life Vs. Boost Converter output settings
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00013 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02550</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Product Lifecycle Sustainment</Address>
      <Title>Data Logging</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}{\f1\fnil\fcharset2 Wingdings;}}
\viewkind4\uc1\pard\f0\fs17 For future diagnostic purpose, the software shall\par
periodically log device performance data to an external memory such that:\par
\f1\'b7\f0  the logging interval is one minute\par
\f1\'b7\f0  the logging duration is at least 7 days from when\par
the device is started for the first time.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The logging manager facilitates the writing of some of the key performance indicators of the device produced by the application into an external EEPROM. As a result, the behaviour of the device may be analysed after it has been used.
This manager is executed as last of the managers within the application so it can capture the most up to date status of the application. As a result, this manager is called on by the application every tick (100ms) but it will write data to the EEPROM every 600 ticks (1 minute, which is determined using a count-down timer). In addition, the logging manager writes to the EEPROM in the first 100ms available slot after the 1 minute boundary when neither the pressure is read nor the pump is activated. This minimises the risk for the application business logic to take more than 100ms tick duration by not having to run too many lengthy operations within the same execution cycle. The following values are logged; see section 4 for format details.
Differential pressure:
Differential vacuum in millibar
External pressure:
External pressure in millibar
Pump Activation history:
History of the pump activation occurrences in the last 32 seconds (i.e. duty cycle)
Loaded battery voltage:
Battery voltage in millivolts during pump activation
Temperature:
Raw ADC reading of the internal temperature sensor
State Machine status:
Current state of the State Machine
Initial Pump Down Duration:
Time taken to first reach target pressure during the initial pump down.
Unloaded battery voltage:
Battery voltage in millivolts when there is no on-going operation
Each row of the EEPROM will hold the records for a specific minute allowing a history for more than 7 days. Once the Logging Manager detects that the EEPROM has been filled, logging will stop.
The logging manager may also be used to stream stored values to the UART as they are read so that these values are visible when connected to an external system. This is only used in a debug version.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00007 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00018 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-33</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00033 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-36</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00036 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-60</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00060 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-68</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00068 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02551</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Product Lifecycle Sustainment</Address>
      <Title>Data Logging – Performance Data</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The periodically logged performance data shall comprise\par
of the following:\par
Differential pressure\par
External Pressure\par
Pump ON/OFF History\par
Battery Voltage (loaded)\par
Battery Voltage (unloaded)\par
Temperature\par
Device State\par
Initial Pump Down duration\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The logging manager facilitates the writing of some of the key performance indicators of the device produced by the application into an external EEPROM. As a result, the behaviour of the device may be analysed after it has been used.
This manager is executed as last of the managers within the application so it can capture the most up to date status of the application. As a result, this manager is called on by the application every tick (100ms) but it will write data to the EEPROM every 600 ticks (1 minute, which is determined using a count-down timer). In addition, the logging manager writes to the EEPROM in the first 100ms available slot after the 1 minute boundary when neither the pressure is read nor the pump is activated. This minimises the risk for the application business logic to take more than 100ms tick duration by not having to run too many lengthy operations within the same execution cycle. The following values are logged; see section 4 for format details.
Differential pressure:
Differential vacuum in millibar
External pressure:
External pressure in millibar
Pump Activation history:
History of the pump activation occurrences in the last 32 seconds (i.e. duty cycle)
Loaded battery voltage:
Battery voltage in millivolts during pump activation
Temperature:
Raw ADC reading of the internal temperature sensor
State Machine status:
Current state of the State Machine
Initial Pump Down Duration:
Time taken to first reach target pressure during the initial pump down.
Unloaded battery voltage:
Battery voltage in millivolts when there is no on-going operation
Each row of the EEPROM will hold the records for a specific minute allowing a history for more than 7 days. Once the Logging Manager detects that the EEPROM has been filled, logging will stop.
The logging manager may also be used to stream stored values to the UART as they are read so that these values are visible when connected to an external system. This is only used in a debug version.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00007 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00018 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-33</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00033 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-36</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00036 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-60</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00060 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-68</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00068 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02560</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Product Lifecycle Sustainment</Address>
      <Title>Data Logging Disable in Idle</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall not log device performance data to an external memory when the therapy has been paused (i.e. Idle state) or has yet to be started for the first time.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The logging manager facilitates the writing of some of the key performance indicators of the device produced by the application into an external EEPROM. As a result, the behaviour of the device may be analysed after it has been used.
This manager is executed as last of the managers within the application so it can capture the most up to date status of the application. As a result, this manager is called on by the application every tick (100ms) but it will write data to the EEPROM every 600 ticks (1 minute, which is determined using a count-down timer). In addition, the logging manager writes to the EEPROM in the first 100ms available slot after the 1 minute boundary when neither the pressure is read nor the pump is activated. This minimises the risk for the application business logic to take more than 100ms tick duration by not having to run too many lengthy operations within the same execution cycle. The following values are logged; see section 4 for format details.
Differential pressure:
Differential vacuum in millibar
External pressure:
External pressure in millibar
Pump Activation history:
History of the pump activation occurrences in the last 32 seconds (i.e. duty cycle)
Loaded battery voltage:
Battery voltage in millivolts during pump activation
Temperature:
Raw ADC reading of the internal temperature sensor
State Machine status:
Current state of the State Machine
Initial Pump Down Duration:
Time taken to first reach target pressure during the initial pump down.
Unloaded battery voltage:
Battery voltage in millivolts when there is no on-going operation
Each row of the EEPROM will hold the records for a specific minute allowing a history for more than 7 days. Once the Logging Manager detects that the EEPROM has been filled, logging will stop.
The logging manager may also be used to stream stored values to the UART as they are read so that these values are visible when connected to an external system. This is only used in a debug version.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00007 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-69</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00069 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 01010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Standby</Address>
      <Title>Standby State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 All LED indications shall be turned OFF in standby state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 01020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Standby</Address>
      <Title>Standby to‘Indicate Activate’</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device shall transition to \lquote Indicate Activate\rquote  on\par
receipt of \lquote BUT_ShortPress\rquote  action from the user.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00020 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 01030</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Standby</Address>
      <Title>Standby to Indicate Activate (Auto)</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device shall transition to Indicate Activate state\par
when\par
\bullet  a period of 60 minutes has elapsed since\par
entering Standby state, and\par
\bullet  the device has previously exited Standby\par
state on action from the user and\par
\bullet  the device has not entered Standby state\par
from Pump-Down state\par
\par
Note: Implementation should parameterize the\par
elapsed duration.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 01040</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Standby</Address>
      <Title>Absence of long press action</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device shall not respond to \lquote BUT_LongPress\rquote  action from the user in Standby state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Power Consumption Tests
This test will verify the current consumption in a number of different states as described in section 3.4.1.1.
In addition, the test also verifies the UIRS 01040 and UIRS 03050 requirements.
3.4.1.1	Test Sequence
1.	Test Case 1: When the system is powered up but the tab has not been pulled.

Measurement State: IDLE.

2.	Test Case 2: When the system is powered up but the tab has not been pulled and after the button has been pressed.

Measurement State: IDLE.

3.	Test Case 3: Power consumption when the tab has been pulled but before the button is pressed.

Measurement State: IDLE.

4.	Test Case 4: Power consumption when the tab is pulled and monitor state entered and paused.

Measurement State: IDLE.

5.	Test Case 5: Power consumption over a period of time when in the MONITOR state. This test will involve using a digital storage scope to capture current pulses when the pump is on and estimating the current consumed for those pulses over a period of time. (I.e. using the measured current, pulse width and number of pulses to provide an estimate for the overall current consumption).

Measurement State: MONITOR
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00014 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The idle state has two power sub-states to allow it to be managed in its storage and operational modes.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00002 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 02010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Activate</Address>
      <Title>Indicate Activate</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry in to Indicate ON state, the device shall execute\par
the following LED flashing pattern:\par
\bullet  Amber LED is OFF, while\par
\bullet  Green LED is ON for 1s\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 02020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Activate</Address>
      <Title>Indicate Activate to Pump Down</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On completion of LED flashing Pattern the device shall transition Pump Down\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 03010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Pump Down</Address>
      <Title>Pump Down State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry to pump down state the device shall execute the following LED pattern:\par
Amber LED is OFF, while:\par
\bullet  For 5s, green LED flashes with 100ms ON time and\par
100ms OFF time, then\par
\bullet  For 15s, green LED continues to flash such that after every 3 ON-OFF cycles, the OFF time increases by 100ms\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes />
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity />
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 03020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Pump Down</Address>
      <Title>Pump Down to Indicate Success</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On completion of LED Pattern, the device shall transition to Indicate Success if negative pressure is successfully achieved.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 03030</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Pump Down</Address>
      <Title>Pump Down to Indicate Fail</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On completion of LED Pattern, the device shall transition to Indicate Fail if negative pressure is not successfully achieved.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 03040</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Pump Down</Address>
      <Title>Pump Down to Indicate Deactivate</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate\par
Deactivate\rquote  on receipt of a \lquote BUT_LongPress\rquote  action\par
from the user.\par
\par
Note: This action is acted upon if and only if started\par
within this state or in Fault state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 03050</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Pump Down</Address>
      <Title>Pump Down to Standby</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Standby\par
State\rquote  if the pull tab is still in place at the time of\par
entering \lquote Pump Down\rquote\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Power Consumption Tests
This test will verify the current consumption in a number of different states as described in section 3.4.1.1.
In addition, the test also verifies the UIRS 01040 and UIRS 03050 requirements.
3.4.1.1	Test Sequence
1.	Test Case 1: When the system is powered up but the tab has not been pulled.

Measurement State: IDLE.

2.	Test Case 2: When the system is powered up but the tab has not been pulled and after the button has been pressed.

Measurement State: IDLE.

3.	Test Case 3: Power consumption when the tab has been pulled but before the button is pressed.

Measurement State: IDLE.

4.	Test Case 4: Power consumption when the tab is pulled and monitor state entered and paused.

Measurement State: IDLE.

5.	Test Case 5: Power consumption over a period of time when in the MONITOR state. This test will involve using a digital storage scope to capture current pulses when the pump is on and estimating the current consumed for those pulses over a period of time. (I.e. using the measured current, pulse width and number of pulses to provide an estimate for the overall current consumption).

Measurement State: MONITOR
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00014 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 04010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Success</Address>
      <Title>Indicate Success</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry to the Indicate success state the device shall\par
execute the following LED pattern:\par
\bullet  Green LED shall be ON for 2s.\par
\bullet  Amber LED shall be OFF.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 04020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Success</Address>
      <Title>Indicate Success to Monitor</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On completion of LED Pattern, the device display\par
shall transition to \lquote Monitor\rquote .\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 05010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Monitor</Address>
      <Title>Monitor</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 All LED indications shall be turned OFF in Monitor state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 05020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Monitor</Address>
      <Title>Monitor to Indicate Status</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate\par
Status\rquote  on receipt of \lquote BUT_ShortPress\rquote  action from\par
user.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 05030</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Monitor</Address>
      <Title>Monitor to Indicate Fail</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate Fail\rquote\par
when\par
\bullet  Loss of target negative pressure has occurred.\par
\bullet  NRV blockage detected\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test verifies that when the Eton Firmware PCBA is in the MONITOR state, if a leak is present for only a short time, it will not cause a failure. The test also verifies that if a leak is present for a longer time, it will cause a failure. In addition, the test also checks that a Short Button Press in the FAULT state will start a pump down sequence.
Test Sequence
MONITOR  Short Button Press  STATUS (‘Indicate Status’)  Brief leak present, MONITOR continues  Brief leak repaired, MONITOR continues  Short Button Press  STATUS (‘Indicate Status’)  (Leak Detected)  STATUS (‘Indicate Fail’)  FAULT  Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Pressure Achieved, STATUS (‘Indicate Success’)  MONITOR  Short Button Press  STATUS (‘Indicate Status’)
State change matrix: 14 14  11  15  8  14.
Prerequisites
This test must be performed with the Pico test dressing, attached to the Perspex sheet (i.e. no reservoir).
This is due to the fact that the Pico test dressing with large reservoir (i.e. 400ml capacity) causes a gross leak rate that is outside of the design limit of a maximum leak of 12 ml/min.
‘Power level is good’.
‘Dressing Connected’.
Run test: “3.2.2 {SysTst_Manual-00001} Idle State Pump Down Test” to bring the system into the MONITOR state.
Test Execution
Test Step
Action
Expected Result
To Verify the system is in the MONITOR state, perform a short press on the OK button.
The green LED will turn ON for two seconds
Cause a leak by disconnecting the Tube connecter attached to the Eton Firmware PCBA for approximately 2 seconds.
You should hear pump start to pump
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.
Verify that no LEDs come on
To Verify still in MONITOR state, perform a short press on the OK button.
The green LED will turn ON for two seconds
Disconnect the Tube connecter attached to the Eton Firmware PCBA for approximately 10 seconds.
You should hear pump start to pump
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Verify a leak has been detected
Now in FAULT state
Since pressure is not met then the amber LED will come on for 2 seconds and then goes off.
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.
Start pump down again, perform a short press on the OK button.
The pump will come on and start pumping.
The green LED will come on for a second.
The green LED will start flashing the pump down sequence
Wait for 20 seconds
After the pump down sequence the green LED will come on for 2 seconds and then goes off
Verify acoustically that the pump stops
(Should now be in the MONITOR state)
Perform a short press on the OK button.
The green LED will turn ON for two seconds
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00009 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 05040</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Monitor</Address>
      <Title>Monitor to Indicate Deactivate</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate\par
Deactivate\rquote  on receipt of a \lquote BUT_LongPress\rquote  action\par
from the user.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 06010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Fail</Address>
      <Title>Indicate Fail</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry to Indicate Fail state the state the device shall execute the following LED pattern:\par
\bullet  Green LED is OFF, while\par
\bullet  Amber LED is ON for 2s\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 06020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Fail</Address>
      <Title>Indicate Fail to Fault</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On completion of the LED pattern the device\par
display shall transition to \lquote Fault\rquote .\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 07010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Fault</Address>
      <Title>Indicate Fault</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry to Leak Alert the state the device shall execute the\par
following LED pattern:\par
\bullet  Green LED is OFF, while\par
\bullet  Amber LED is ON for 0.2s, OFF for 1.8s\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 07020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Fault</Address>
      <Title>Fault to Indicate Activate (Auto)</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate\par
Activate State\rquote  when 60 minutes has elapsed since\par
entering Fault state.\par
\par
Note: Implementation should parameterize the\par
elapsed duration.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 07030</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Fault</Address>
      <Title>Fault to indicate deactivate</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to Indicate\par
Deactivate state on detection of BUT_LongPress.\par
\par
Note: until the long button press is detected, the\par
device may already leave the Fault state. So this\par
requirement specifies the eventual transition to\par
indicate deactivate.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 07040</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Fault</Address>
      <Title>Fault to indicate activate</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate\par
Activate\rquote  on receipt of \lquote BUT_ShortPress\rquote  action\par
from user.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test verifies that when the Eton Firmware PCBA is in the MONITOR state, if a leak is present for only a short time, it will not cause a failure. The test also verifies that if a leak is present for a longer time, it will cause a failure. In addition, the test also checks that a Short Button Press in the FAULT state will start a pump down sequence.
Test Sequence
MONITOR  Short Button Press  STATUS (‘Indicate Status’)  Brief leak present, MONITOR continues  Brief leak repaired, MONITOR continues  Short Button Press  STATUS (‘Indicate Status’)  (Leak Detected)  STATUS (‘Indicate Fail’)  FAULT  Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Pressure Achieved, STATUS (‘Indicate Success’)  MONITOR  Short Button Press  STATUS (‘Indicate Status’)
State change matrix: 14 14  11  15  8  14.
Prerequisites
This test must be performed with the Pico test dressing, attached to the Perspex sheet (i.e. no reservoir).
This is due to the fact that the Pico test dressing with large reservoir (i.e. 400ml capacity) causes a gross leak rate that is outside of the design limit of a maximum leak of 12 ml/min.
‘Power level is good’.
‘Dressing Connected’.
Run test: “3.2.2 {SysTst_Manual-00001} Idle State Pump Down Test” to bring the system into the MONITOR state.
Test Execution
Test Step
Action
Expected Result
To Verify the system is in the MONITOR state, perform a short press on the OK button.
The green LED will turn ON for two seconds
Cause a leak by disconnecting the Tube connecter attached to the Eton Firmware PCBA for approximately 2 seconds.
You should hear pump start to pump
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.
Verify that no LEDs come on
To Verify still in MONITOR state, perform a short press on the OK button.
The green LED will turn ON for two seconds
Disconnect the Tube connecter attached to the Eton Firmware PCBA for approximately 10 seconds.
You should hear pump start to pump
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Verify a leak has been detected
Now in FAULT state
Since pressure is not met then the amber LED will come on for 2 seconds and then goes off.
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.
Start pump down again, perform a short press on the OK button.
The pump will come on and start pumping.
The green LED will come on for a second.
The green LED will start flashing the pump down sequence
Wait for 20 seconds
After the pump down sequence the green LED will come on for 2 seconds and then goes off
Verify acoustically that the pump stops
(Should now be in the MONITOR state)
Perform a short press on the OK button.
The green LED will turn ON for two seconds
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00009 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 08010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Status</Address>
      <Title>Indicate Status</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry to Indicate Status the device shall execute the\par
following LED pattern:\par
\bullet  Amber LED is OFF, while\par
\bullet  Green LED ON for 2s\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 08020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Status</Address>
      <Title>Indicate Status to Monitor</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 After the LED pattern is completed the device\par
display shall transition to \lquote Monitor\rquote .\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 09010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Deactivate</Address>
      <Title>Indicate Deactivate</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 On entry to Indicate Deactivate, the device shall execute the following LED pattern:\par
1. Green LED is ON for 2s whilst amber is OFF.\par
2. Amber is ON for 1s whilst Green LED is OFF\par
3. Green and Amber LEDs OFF.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 09020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Indicate Deactivate</Address>
      <Title>Indicate Deactivate to Standby</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 After the LED pattern is completed the device shall transition to Standby.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 10010</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|NRE</Address>
      <Title>NRE State Indication</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 All LED indications shall be turned OFF in Error state\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Tests following state transitions:
1.		IDLE	PUMP_DOWN	Key Press
2.		IDLE	PUMP_DOWN	1 Hour Time-out
3.		PUMP DOWN	IDLE	Voltage out of range
4.		PUMP DOWN	SHUT DOWN	Long Button Press
5.		PUMP DOWN	FAULT	Failed to reach pressure
6.		PUMP DOWN	FAULT	Tracker Frequency Fail
7.		PUMP DOWN	MONITOR	20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.
8.		PUMP DOWN	NRE	Battery EOL
9.		MONITOR	SHUT DOWN	Long Button Press
10.		MONITOR	FAULT	Leak Detected
11.		MONITOR	FAULT	Frequency out of range 
12.		MONITOR	FAULT	Voltage out of range
13.		MONITOR	FAULT	NVR Block
14.		MONITOR 	NRE	Battery Life End
15.		MONITOR
( or any state )	NRE	Log Buffer Full
16.		MONITOR 	Sub-State 
INDICATE STATUS	Short Button Press
17.		FAULT	PUMP DOWN	Short Press. 
18.		FAULT	PUMP DOWN	Long Press. Short press is taken first which transits to long press and then SHUT DOWN
19.		FAULT	PUMP DOWN	Fault Time-out 60 minutes
20.		SHUT DOWN	IDLE	3 second timeout
21.		NRE		No exit
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00001 (|Test|SOTST003 Eton Firware Automated Tests|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 10020</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|NRE</Address>
      <Title>NRE state entry</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to NRE state on\par
occurrence of a non-recoverable error condition.\par
\par
Note: Non-recoverable error conditions include\par
battery depletion and any internal error that cannot\par
be recovered without device maintenance.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01140</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Pressure/Temperature</Address>
      <Title>Pressure Reading</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall have the ability to retrieve the pressure measurements from internal and external pressure sensors\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Read pressure sensors to determine the current vacuum, decide if this is at target level depending on which state of the therapy delivery (IPD or MPD) the application is in.
Check if a gross leak condition has occurred during therapy maintenance.
Update the target vacuum value during therapy maintenance based on pump duty cycle.
This module consists of a number of sub-modules (e.g. Part 1..4) that abstract the interface with the State Machine from the lower level operations (e.g. I2C) to get and validate the pressure values form the external HW peripherals. This also allows unit testing of business logic independently of HW. (E.g. use of the leak detection output).”
The highest level sub-module (Pressure_Part1.c) is used by the State Machine; the intermediate sub module uses the duty cycle module (DutyCycle.c) for some of its business logic, and the lowest level sub module (e.g. Pressure_Part4.c) interacts with the HW peripherals allocated to the pressure sensors (i2c.c).
The pressure sensor module adopts a number of mechanisms to guarantee valid vacuum readings are produced:
Both internal and external pressure readings must be successful otherwise an error is returned
Each pressure read operation is repeated a number of times in case of unsuccessful acquisition, before returning an error
Internal Temperate Senor
This module also reads the temperature from the internal pressure sensor. The value read is a 16 bit 2’compliment number and is logged in the EEPROM by the Performance logger Manager. In order to calculate the actual temperature in °C the following formulae is used (42.5 - (value/480)).
(See reference [6] for further details
https://www.st.com/content/ccc/resource/technical/document/technical_note/23/dd/08/f8/ac/cf/47/83/DM00242307.pdf/files/DM00242307.pdf/jcr:content/translations/en.DM00242307.pdf for further details)
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00019 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 01150</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Hardware Interfaces|Pressure/Temperature</Address>
      <Title>Temperature Sensors</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall have the ability to retrieve the temperature measurements from internal and external pressure sensors\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Read pressure sensors to determine the current vacuum, decide if this is at target level depending on which state of the therapy delivery (IPD or MPD) the application is in.
Check if a gross leak condition has occurred during therapy maintenance.
Update the target vacuum value during therapy maintenance based on pump duty cycle.
This module consists of a number of sub-modules (e.g. Part 1..4) that abstract the interface with the State Machine from the lower level operations (e.g. I2C) to get and validate the pressure values form the external HW peripherals. This also allows unit testing of business logic independently of HW. (E.g. use of the leak detection output).”
The highest level sub-module (Pressure_Part1.c) is used by the State Machine; the intermediate sub module uses the duty cycle module (DutyCycle.c) for some of its business logic, and the lowest level sub module (e.g. Pressure_Part4.c) interacts with the HW peripherals allocated to the pressure sensors (i2c.c).
The pressure sensor module adopts a number of mechanisms to guarantee valid vacuum readings are produced:
Both internal and external pressure readings must be successful otherwise an error is returned
Each pressure read operation is repeated a number of times in case of unsuccessful acquisition, before returning an error
Internal Temperate Senor
This module also reads the temperature from the internal pressure sensor. The value read is a 16 bit 2’compliment number and is logged in the EEPROM by the Performance logger Manager. In order to calculate the actual temperature in °C the following formulae is used (42.5 - (value/480)).
(See reference [6] for further details
https://www.st.com/content/ccc/resource/technical/document/technical_note/23/dd/08/f8/ac/cf/47/83/DM00242307.pdf/files/DM00242307.pdf/jcr:content/translations/en.DM00242307.pdf for further details)
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00019 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02031</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Activation/Deactivation (Standby)</Address>
      <Title>Pull tab Not Removed</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device shall remain in the standby state if the software detects that the output Boost Voltage ADC cannot be generated and is less than 6V.\par
\par
Note 1: this implies that the hardware latch has not been activated\par
Note 2: the software may attempt to exit and return to standby state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Power Consumption Tests
This test will verify the current consumption in a number of different states as described in section 3.4.1.1.
In addition, the test also verifies the UIRS 01040 and UIRS 03050 requirements.
3.4.1.1	Test Sequence
1.	Test Case 1: When the system is powered up but the tab has not been pulled.
Measurement State: IDLE.
2.	Test Case 2: When the system is powered up but the tab has not been pulled and after the button has been pressed.
Measurement State: IDLE.

3.	Test Case 3: Power consumption when the tab has been pulled but before the button is pressed.

Measurement State: IDLE.

4.	Test Case 4: Power consumption when the tab is pulled and monitor state entered and paused.

Measurement State: IDLE.

5.	Test Case 5: Power consumption over a period of time when in the MONITOR state. This test will involve using a digital storage scope to capture current pulses when the pump is on and estimating the current consumed for those pulses over a period of time. (I.e. using the measured current, pulse width and number of pulses to provide an estimate for the overall current consumption).

Measurement State: MONITOR
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00014 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The device status serves as a means for communication between the managers and the state machine or between states for specific aims (i.e. long button press propagation, Idle deep sleep mode transition). Managers and the state machine update or monitor the flags they are interested in and act upon the changes of the status whenever they are changed in the main application loop.
Status Flag
Description
Writer
Reader
Device State
Current state of the State Machine manager
State Machine
Alert Manager,
Logging Manager
Device State On Entry
Indicates if the State Machine is to run the current state for the first time (i.e.as result of state change.
State Machine
Test framework
LED status
Indicates if any of the LED is ON or OFF (if ON the main power circuit mustn’t be disabled)
Alert Manager
State Machine
Therapy Status Check
Indicates the user needs to check (specific visual alert) if therapy is being delivered during maintenance.
State Machine
Alert Manager
Enter Deep Sleep
The device has detected one of the conditions triggering the state machine to go into Idle Deep. Sleep
State Machine
State Machine (Idle)
Button Press from Fault
Indicate that a manual restart has been started from fault and the long
press event has to be carried across IPD and MPD (rather than be reset as it usually happens during a state transition)
State Machine
Logging Manager
Pump Running
Indicates the Pump is running so any I2C operation should be avoided (e.g. Prevents the Logging Manager to write the device performances into non- volatile memory)
State Machine
Logging
Pressure being read
Indicates the pressure sensors are being read by the State Machine ,so any other I2C operation should be avoided (prevents the Logging Manager to write the device performances into non-volatile memory)
State Machine
Logging
Table 6, Device Status Flags
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00008 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02050</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Activation/Deactivation (Standby)</Address>
      <Title>Accidental de-activation</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 When starting the therapy from standby via BUT_ShortPress, the software shall ignore subsequent BUT_LongPress generated as a result of continuing to hold down the button. \par
\par
Note: The long press should work if the long press event is generated after short button press is released.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The main operation of the device is governed by the operational therapy state machine as shown in Figure 4. It is responsible for starting/stopping therapy and ensuring that the correct therapy is delivered.
Figure 4, Device operational state machine
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00004 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00020 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-53</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00053 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02090</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pump down</Address>
      <Title>NRV Blockage Detection</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall enter Fault state if an NRV blockage is detected in pump down state using the following algorithm. \par
\par
Detection Algorithm:\par
NRV blockage is said to have occurred if the external pressure exceeds the NRV_THRESHOLD.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This processing allows for a blockage of the external valve to be detected. This works by reading the external pressure when the pump down is started. If the valve is blocked the external pressure will increase as the sensor is behind the vent. If this pressure increases by more than 30 mBar then a blockage has occurred.
This is also checked during the therapy maintenance and if the external pressure again increases by more than 30 mBar then a blockage has occurred. The threshold level for the failure is calculated by the initial pump down module and made available for the therapy maintenance module.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00018 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02080</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Pump down</Address>
      <Title>NRV Threshold Measurement</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall set NRV_THRESHOLD by adding 30mbar to the external pressure measurement taken upon entering pump down.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This processing allows for a blockage of the external valve to be detected. This works by reading the external pressure when the pump down is started. If the valve is blocked the external pressure will increase as the sensor is behind the vent. If this pressure increases by more than 30 mBar then a blockage has occurred.
This is also checked during the therapy maintenance and if the external pressure again increases by more than 30 mBar then a blockage has occurred. The threshold level for the failure is calculated by the initial pump down module and made available for the therapy maintenance module.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00018 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02131</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>IPD Success Alert</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall raise a visual alert to indicate successful pump down.\par
\par
Note: Visual alert sequences should conform to the UIRS.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-44</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00044 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02150</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>NRV Blockage MPD</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall enter Fault state if an NRV blockage is detected in monitor state using the following algorithm. \par
\par
Detection Algorithm:\par
NRV blockage is said to have occurred if the external pressure exceeds the NRV_THRESHOLD.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This processing allows for a blockage of the external valve to be detected. This works by reading the external pressure when the pump down is started. If the valve is blocked the external pressure will increase as the sensor is behind the vent. If this pressure increases by more than 30 mBar then a blockage has occurred.
This is also checked during the therapy maintenance and if the external pressure again increases by more than 30 mBar then a blockage has occurred. The threshold level for the failure is calculated by the initial pump down module and made available for the therapy maintenance module.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00018 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02220</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>MPD Check Status Alert</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall provide visual indication upon BUT_ShortPress while the device in monitor state. \par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:
1. Green LED
2. Orange LED
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-55</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00055 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02230</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>No Therapy Indication Without a Button Press</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall provide no indication to the user during (successful) therapy delivery in the absence of BUT_ShortPress\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.
3.2.8.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
The above sequence is followed by the sequence below,
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE à 
And that is repeated a further 3 times as shown below.
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 1 à 8 à 14 à 10 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18 à 1 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00007 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00006 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.
Event
Description
Time out
Monitor the pressure every 1 second.
Read the pressure, if it’s too low then switch the pump on for 100ms.
Pressure Fail
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state
Voltage out of range
Or
Power Tracker Frequency Fail
Enter FAULT state
Long button press
Switch LEDs off
Enter POWER DOWN state
Short Press or
Pump Down LED sequence completed
Display Success status
Enter NRE
Battery Life End
EOL
End of 7 days therapy.
NRV
NRV Blockage
Power Saving
Battery maintenance
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00006 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02240</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Delivery of therapy|Monitor State</Address>
      <Title>Leak Detection</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall transition to fault state if Duty Cycle is above a Leak Limit of 15 MPD pump activations for 30 consecutive seconds.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test verifies that when the Eton Firmware PCBA is in the MONITOR state, if a leak is present for only a short time, it will not cause a failure. The test also verifies that if a leak is present for a longer time, it will cause a failure. In addition, the test also checks that a Short Button Press in the FAULT state will start a pump down sequence.
Test Sequence
MONITOR  Short Button Press  STATUS (‘Indicate Status’)  Brief leak present, MONITOR continues  Brief leak repaired, MONITOR continues  Short Button Press  STATUS (‘Indicate Status’)  (Leak Detected)  STATUS (‘Indicate Fail’)  FAULT  Short Button Press  STATUS (‘Indicate Activate’)  PUMP DOWN  Pressure Achieved, STATUS (‘Indicate Success’)  MONITOR  Short Button Press  STATUS (‘Indicate Status’)
State change matrix: 14 14  11  15  8  14.
Prerequisites
This test must be performed with the Pico test dressing, attached to the Perspex sheet (i.e. no reservoir).
This is due to the fact that the Pico test dressing with large reservoir (i.e. 400ml capacity) causes a gross leak rate that is outside of the design limit of a maximum leak of 12 ml/min.
‘Power level is good’.
‘Dressing Connected’.
Run test: “3.2.2 {SysTst_Manual-00001} Idle State Pump Down Test” to bring the system into the MONITOR state.
Test Execution
Test Step
Action
Expected Result
To Verify the system is in the MONITOR state, perform a short press on the OK button.
The green LED will turn ON for two seconds
Cause a leak by disconnecting the Tube connecter attached to the Eton Firmware PCBA for approximately 2 seconds.
You should hear pump start to pump
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.
Verify that no LEDs come on
To Verify still in MONITOR state, perform a short press on the OK button.
The green LED will turn ON for two seconds
Disconnect the Tube connecter attached to the Eton Firmware PCBA for approximately 10 seconds.
You should hear pump start to pump
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Verify a leak has been detected
Now in FAULT state
Since pressure is not met then the amber LED will come on for 2 seconds and then goes off.
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.
Start pump down again, perform a short press on the OK button.
The pump will come on and start pumping.
The green LED will come on for a second.
The green LED will start flashing the pump down sequence
Wait for 20 seconds
After the pump down sequence the green LED will come on for 2 seconds and then goes off
Verify acoustically that the pump stops
(Should now be in the MONITOR state)
Perform a short press on the OK button.
The green LED will turn ON for two seconds
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00009 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.
Event
Description
Time out of 2s
Start flash of Amber for 60s
Amber LED is ON for 0.2 OFF for 1.8s
Time out of 60mins
Enter PUMP DOWN state
Short Button Press
Enter PUMP DOWN state
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00007 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>Calculate the duty cycle between Pump ON and OFF in the Therapy Maintenance state. During each second the pump will come on for 100ms if more pressure is need or stay off if pressure is not needed. The duty cycle is the ratio of the number of on seconds within a fixed period of n readings. This module uses a sliding window to keep track of the most recent pump activity history (e.g. last 32 seconds). That is every second when the vacuum is calculated the sliding window is shifted along and the new record added to the end.
The module also determines which portion of the duty cycle history is used to detect a gross leak condition; too frequent pump activation indicates the presence of a gross leak which the application cannot sustain without depleting the battery prematurely. In this case, if a maximum number of pump activations (i.e. &gt;15) in the defined gross leak detection window (i.e. 30 seconds) occurs, the State Machine will transition into a Fault state giving the user the opportunity to readjust the dressing and possibly resolve the unsustainable leak.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00015 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-8</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00008 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02380</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Non Recoverable Error</Address>
      <Title>Disable Peripherals in NRE State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall stop therapy, disable all the hardware peripherals (including LED\rquote s) and any functionality to restart the device if a non-recoverable error occurs\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.
LED Pump Down Sequence
The following table shows the LED sequence which activated when the pump down sequence is started.
Units are 100mS.
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.
Phase
On Time
100mS
Off Time
100mS
Total Duration
Repeat
Count
Description
Phase 1
10
0
1s
LED on for a second
Phase 2
1
1
5s
LED flashes rapidly for 5 second
Phase 3
1
1
600ms
3
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.
Run the on/off sequence 3 times.
1
2
900ms
3
Off is increased by 1 after every 3 cycles.
1
3
1200ms
3
1
4
1500ms
3
Repeat for 15 secondsby which time pump down will timeout
If pressure has not been reached then the state will be changed by the main FSM
Phase 4
20
0
2s
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.
Table 7 LED Pump Down Sequence
LED Status
The status sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
1 second
Off
Off
Continuously
Table 8 LED Status Sequence
LED Power Down
The power down sequence will be as follows.
Green LED Status
Orange LED Status
Duration
On
Off
2 seconds
Off
On
1 second
Off
Off
Continuously
Table 9 LED Power Down Sequence
LED Fault
The leak sequence will be as follows.
Step
Green LED Status
Orange LED Status
Duration
1
Off
On
2 seconds
2
Off
On
.2 seconds
3
Off
Off
1.8 seconds
Table 10 LED Leak Sequence
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00012 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>HET-35</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>ESUTS-00035 (|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix)</TestId>
          <TestPlugin>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>SRS 02450</Id>
      <Address>|Eton Firmware Software Requirements Specification v3|Functional Requirements|Battery management</Address>
      <Title>Power Saving Sleep Mode</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The software shall make use of the microcontroller low power modes during periods of inactivity in order to save power in fault, monitor and standby states.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) àMONITOR à Short Button Press à STATUS (‘Indicate Status’)
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00001 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test pauses when it is in the MONITOR state.
Note: This test is also used to start off other tests.
3.2.3.1	Test Sequence
MONITOR à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00002 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test is the basic test of the pump down sequence when the dressing is not connected.
It is also used to start off other tests.
3.2.4.1	Test Sequence
IDLE à Short Button Press à STATUS (‘Indicate Activate’’) à PUMP DOWN à Leak Detected (Failed to reach pressure) à STATUS (‘Indicate Fail’) à FAULT
State change matrix:1 à 5</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00003 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests that the system can be paused from the FAULT state.
This test is also used by other tests.
3.2.5.1	Test Sequence
FAULT à Long Button Press (Short Button Press) à STATUS (‘Indicate Activate’) à PUMP DOWN (transitory) à Long Button Press à STATUS (‘Indicate Deactivate’) à SHUT DOWN à 3 second Time-out à IDLE
State change matrix: 17 à 4 à 18
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00004 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.
3.2.6.1	Test Sequence
IDLE à 60 minutes Time-out à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 2 à 8 à 14.</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00005 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.
3.2.7.1	Test Sequence
FAULT à Fault Time-out 60 minutes à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)
State change matrix: 16 à 8 à 14</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>SysTst_Manual-00006 (|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.
Deep Sleep Mode
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).
The deep sleep mode is entered when:
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.
Therapy Power Management
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.
However, the Eton software minimizes the power consumption with the following approach:
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled
In Fault (e.g. LEAK) state, all the external peripherals are disabled
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled
At the end of each execution cycle, the application disables all the peripherals that are not in use
Power Saving State
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00002 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This tests the timing of the managers within the system do not use more than their allocated time in any one schedule (i.e. 100ms) and also that the processor goes to sleep in unused ticks during therapy. The test monitors that amount of free time available after the processing of one tick and the start of the next tick. This is achieved by simply keeping a loop count in the application of the number of times the tick flag is checked before it becomes active from the low level interrupt. The results are output via the UART port.
To test the power saving function is active a count is used to switched on and off the call to the routine which sleeps to the next tick when the system is in therapy mode. When the power saving is active, the processor will sleep until the next tick occurs and when it is not active there will be a large count as the processor waits </Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>EFATS-00003 (|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests)</TestId>
          <TestPlugin>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 03031</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|Pump Down</Address>
      <Title>Pump Down to Indicate Fail (Blockage)</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to \lquote Indicate Fail\rquote\par
if NRV blockage is detected.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA’s handling of NRV errors.
3.6.1.1	Test Sequence
	
1.	PUMP DOWN à FAULT (NRV Block) State change. Test Steps #1 to #10.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 1 à 6 à 15 à 8.
2.	MONITOR à FAULT (NRV Block) State change. Test Steps #11 to #17.
MONITOR à Exhaust Hole blocked, STATUS (‘Indicate Fail’) à FAULT (NRV Block) à STATUS (‘Indicate Fault’) à Exhaust Hole cleared, FAULT continues à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à Pressure Achieved, STATUS (‘Indicate Success’) à MONITOR à Short Button Press à STATUS (‘Indicate Status’)

State change matrix: 12 à 15 à 8.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00016 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This state is entered from:
•	IDLE state, by means of short button press or 60 minute auto-restart.
•	FAULT state, by mean of short button press or 60 minute auto-restart. 
It will start the pump down LED sequence provided by the LED Control Module.  
Event	Description
100ms schedule 
delay	On each schedule the pump down alternates between reading the pressure and pumping.
Long button press 	Switch LEDs off
Enter POWER DOWN state
Time out after 20s	Pressure has not been achieved in last 5 seconds of the pump down 
Enter Fault state
Time out after 20s	Pressure has been achieved in the last 5 seconds of the pump down.
Enter MONITOR state.
Note: It will be up to the monitor state to display success. 
Voltage out of range	Enter the IDLE state
Power Tracker Frequency Fail	Enter the FAULT state
Enter NRE	Battery Life End
Enter NRV	NRV
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00005 (|Design|SODSN001 - PumpDown|Pump Down State)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Requirement</EntityType>
      <Id>UIRS 10030</Id>
      <Address>|Eton Firmware - User Interface Requirement Specification v3.|NRE</Address>
      <Title>NRE state entry - EOL</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device display shall transition to NRE state\par
when the programmed service life of the device has\par
elapsed since first activation.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA’s handling of hardware errors.
3.5.1.1	Test Sequence

1.	MONITOR à NRE State change. Test Steps #1 to #9.
MONITOR à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 13 à 19.
2.	PUMP DOWN à NRE State change. Test Steps #11 to #20.
IDLE à Short Button Press à STATUS (‘Indicate Activate’) à PUMP DOWN à NRE Battery Life End (EOL) à Short Button Press, NRE continues à Short Button Press, NRE continues à Long Button Press, NRE continues à Long leak present, NRE continues à Long leak repaired, NRE continues à Long leak present, Fault Time-out 60 minutes, NRE continues à Long leak repaired, NRE continues à Eton Firmware PCBA Power down, test end.

State change matrix: 1 à 9 à 19.
</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId>00015 (|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware)</TestId>
          <TestPlugin>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</TestPlugin>
          <Environment>Non-Test Tool Suite Test Specification</Environment>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesArch-00009 (|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer)</LinkedEntity>
        </EntityMapping>
        <EntityMapping xsi:type="EntityDocumentMapping">
          <Notes>For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the “on entry” arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:
ICT POST
Idle (therapy paused or deep sleep)
Initial Pump Down (Initial pump down)
Therapy Maintenance or MPD state (therapy delivery)
Fault (recoverable error)
Power Down (intermediate step to Idle)
NRE (non-recoverable error)
NRV (Non return valve)
The Idle state consists in two sub-states: Deep Sleep where the
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.
State
Description
Initial Pump Down (IPD)
This state is entered after a user start or an automatic restart. Therapy is started.
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.
If an out of range voltage error occurs the device will transit to the Idle state.
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.
Therapy Maintenance (MPD)
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.
IDLE
(deep sleep)
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a “Voltage out of Range” error will occur and the system will return to the deep sleep IDLE state.
IDLE
(pause)
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:
The therapy has been pauseddue to a long button press.
FAULT
(recoverable error)
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.
FAULT
(non-recoverable error)
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)
This state is entered when:
The device reaches End of Life (EOL) in any of the Therapy Active states.
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.
Integrated Circuit Test
POST
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")
Table 2, Operational States
Pump Down Logic
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.
Figure 5, Pump Down timeline
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure
Fault
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
IDLE (deep sleep)
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.
Table 3, IPD errors triggering a state transition
Therapy Maintenance Logic
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])
Activating the pump if needed during the second 100ms of the 1 second slot
Do nothing in the next 800ms to save the battery power.
Figure 6, Therapy Maintenance timeline
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:
Vacuum Reading validation:
check if valid vacuum readings can be successfully acquired (see section 3.5.11)
Fault detection:
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)
Target Vacuum update:
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)
Pump Frequency update:
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)
Boost Converter OutputVoltage check:
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)
Battery output Voltage check:
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)
Functionality
Execution Phase
Period(s)
Status if battery is depleting
(i.e. Boost Converter output Voltage &lt;MAX)
Vacuum Reading validation
READ VACUUM
(PUMP OFF)
1
enabled
Leak detection
READ VACUUM
(PUMP OFF)
1
disabled
Target Vacuum update
READ VACUUM
(PUMP OFF)
9
disabled
Pump Frequency update
PUMP ON
&gt;=1
enabled
Boost Converter output Voltage check
PUMP ON
&gt;=1
enabled
Battery output voltage check
PUMP ON
&gt;=1
enabled
Table 4, Therapy Maintenance main operations during Pump ONphases
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.
Priority
(1-highest)
Error
New state
Description
1
External pressure is 30 mBar greater than the initial pressure read at pump down
Fault
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.
This scenario indicates that the external valve has been blocked.
2
Piezo Pump frequency out of range
Fault
The piezo pump is faulty because the optimum frequency has fallen out of the working range
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
3
Boost Converter voltage out of range
Fault
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.
4
Battery depleted
NRE
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.
5
Unsuccessful pressure reading
Fault
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure
Table 5, MPD errors triggering a state transition
</Notes>
          <LinkedEntityType>Design</LinkedEntityType>
          <LinkedEntity>Dsn_DesSpec-00005 (|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers)</LinkedEntity>
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00001</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Idle State Pump Down Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test is the basic test of the pump down sequence.\par
Note: This test is also used to start off other tests.\par
Test Sequence\par
IDLE  Short Button Press  STATUS (\lquote Indicate Activate\rquote\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote ) MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 1  8  14\par
Prerequisites\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Follow the procedure in section 2.6 to put the Eton Firmware PCBA in the IDLE state.\par
The Eton Firmware PCBA is in the IDLE state.\par
To start a successful pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait 20 seconds\par
After the pump down sequence the green LED will come on for 2 seconds and then goes off\par
Verify acoustically that the pump stops\par
Wait for a minute\par
Verify that no LEDs come on\par
Now in MONITOR state\par
To Verify that the status works, perform a short press on the OK button.\par
The green LED will come on for two seconds and then goes off.\par
}
</Description>
      <Notes />
      <ContentValue>VJZBeP2G5Qa4NlenSqGZcQ</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00002</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Pause In Monitor State Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test pauses when it is in the MONITOR state.\par
Note: This test is also used to start off other tests.\par
Test Sequence\par
MONITOR  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
State change matrix:10  18\par
Prerequisites\par
Run test \ldblquote 3.2.2 \{SysTst_Manual-00001\} Idle State Pump Down Test\rdblquote  to put the PCBA into the MONITOR state.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To Pause the monitor, perform a long press on the OK button.\par
This should take the system back to the IDLE state.\par
(The green will flash on due status function when started from MONITOR state)\par
Verify the green LED comes on for 2 seconds and then goes off again.\par
The amber LED will come on for 1 second and then goes off\par
Wait for a minute\par
Verify that no LEDs come on\par
Now in IDLE state\par
}
</Description>
      <Notes />
      <ContentValue>oiKw3Zp+cs6JhK2koqrF5A</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00003</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Idle State Pump Down Fail Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test is the basic test of the pump down sequence when the dressing is not connected.\par
It is also used to start off other tests.\par
Test Sequence\par
IDLE  Short Button Press  STATUS (\lquote Indicate Activate\rquote\rquote )  PUMP DOWN  Leak Detected (Failed to reach pressure)  STATUS (\lquote Indicate Fail\rquote )  FAULT\par
State change matrix:1  5\par
Prerequisites\par
The PCBA is in the IDLE state.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Not Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To Start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait 20 seconds\par
Now in FAULT state\par
Since pressure is not met then the amber LED will come on for 2 seconds and then goes off.\par
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.\par
Wait for a minute\par
Verify the amber LED continues to flash.\par
}
</Description>
      <Notes />
      <ContentValue>R7FvxMnOjsYOPRo21fQaig</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00004</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Pause In Fault State Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This tests that the system can be paused from the FAULT state.\par
This test is also used by other tests.\par
Test Sequence\par
FAULT  Long Button Press (Short Button Press)  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN (transitory)  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
State change matrix: 17  4  18\par
Prerequisites\par
Ensure that test \ldblquote 3.2.4 \{SysTst_Manual-00003\} Idle State Pump Down Fail Test\rdblquote  has been run prior to beginning the test to ensure the PCBA is in the FAULT state.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Not Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To Pause the FAULT state, perform a long press on the OK button.\par
This should take the system back to the IDLE state.\par
The green LED will flash and the pump will come on for a short time and then the following sequence will be followed.\par
Verify the green LED comes on for 2 seconds and then goes off again.\par
The amber LED will come on for 1 second and then goes off.\par
Wait for a minute\par
Verify that no LEDs come on\par
Now in IDLE state\par
}
</Description>
      <Notes />
      <ContentValue>pYlqT/rNlzvw830bim4QAg</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00005</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Idle State Auto Restart Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This will test the retry in the IDLE state when monitor has been paused. It will attempt to restart pump down after 1 hour.\par
Test Sequence\par
IDLE  60 minutes Time-out  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 2  8  14.\par
Prerequisites\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Run test \ldblquote 3.2.2 \{SysTst_Manual-00001\} Idle State Pump Down Test\rdblquote  followed by test \ldblquote 3.2.3 \{SysTst_Manual-00002\} Pause In Monitor State Test\rdblquote  to bring the system into the paused state from a FAULT state and ensuring the system is in the IDLE state.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To ensure that the pump down automatically restarts after an hour,\par
Wait for 1 hour\par
The pump will come on and start pumping.\par
You should hear it.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait for 1 minute\par
Verify that no LEDs come on\par
Now in MONITOR state\par
To Verify the status works, perform a short press on the OK button.\par
The green LED will turn ON for two seconds\par
}
</Description>
      <Notes />
      <ContentValue>4RpuVvsXQXJeESPYLhF6lA</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00006</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Fault State Auto Restart Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This will test the retry of pump down when the system is in the FAULT state. It will attempt to restart pump down after 1 hour.\par
Test Sequence\par
FAULT  Fault Time-out 60 minutes  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 16  8  14\par
Prerequisites\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Run test \ldblquote 3.2.4 \{SysTst_Manual-00003\} Idle State Pump Down Fail Test\rdblquote  to bring the system into the FAULT state.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Encapsulate the dressing\par
To ensure that the pump down automatically restarts after an hour,\par
Wait for 1 hour\par
The pump will come and start pumping.\par
You should hear it.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait for 1 minute\par
Verify that no LEDs come on\par
Now in MONITOR state\par
To Verify that the system is in MONITOR state, perform a short press on the OK button.\par
The green LED will turn ON for two seconds\par
}
</Description>
      <Notes />
      <ContentValue>z0We3ZLzVh3fFR+N6FebFg</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00007</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Pause and Short Button Press During Pump Down Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This tests that short button presses during the pump down will be ignored and long presses will cause the pump down to be paused.\par
Test Sequence\par
IDLE  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
The above sequence is followed by the sequence below,\par
Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
And that is repeated a further 3 times as shown below.\par
Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
State change matrix: 1  8  14  10  18  1  4  18  1  4  18  1  4  18  1  4  18\par
Prerequisites\par
The Eton Firmware PCBA is in the IDLE state.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To Start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
For the next 10 seconds repeatedly perform short button presses\par
Verify that the pump down sequence continues.\par
Wait for 3 seconds\par
Verify the pump down sequence completes with a 2 second on phase.\par
Wait for 1 minute\par
Verify that no LEDs come on\par
Now in MONITOR state\par
To Verify the status works, perform a short press on the OK button.\par
The green LED will come on for two seconds and goes off.\par
To Return to the IDLE state, perform a long press on the OK button.\par
This should take the system back to the idle state.\par
(The green will flash on due status function when started from MONITOR state)\par
Verify the green LED comes on for 2 seconds and then goes off again.\par
The amber LED will come on for 1 second and then goes off\par
Wait for a minute\par
Verify that no LEDs come on\par
Now in IDLE state\par
To Start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
Perform a long press on the OK button.\par
This should take the system back to the idle state.\par
Verify the green LED comes on for 2 seconds and then goes off again.\par
The amber LED will come on for 1 second and then goes off\par
Repeat the last 3 steps 3 times and vary when the long button press is started\par
Verify the system always returns to the IDLE state\par
}
</Description>
      <Notes />
      <ContentValue>B1pYeb7KfF9XDIqFd2aefA</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00008</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Long Press from the Idle State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This tests that a long button press from the idle state will be treated as a short button press, which will cause the pump down to start. The button press will then be ignored.\par
Test Sequence\par
IDLE  Long Button Press (for &gt; 2 seconds)  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Release Button, PUMP DOWN continues  1 second delay, PUMP DOWN continues  Long Button Press  STATUS (\lquote Indicate Deactivate\rquote )  SHUT DOWN  3 second Time-out  IDLE\par
State change matrix: 1 4 18\par
Prerequisites\par
The Eton Firmware PCBA is in the IDLE state.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To Start a pump down, perform a long press on the OK button for more than 2 seconds.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The pump down sequence starts.\par
Release the Button\par
Verify that the pump down sequence continues.\par
Delay 1 second\par
Verify that the pump down sequence continues.\par
Perform a long press on the OK button.\par
Verify the green LED comes on for 2 seconds and then goes off again.\par
The amber LED will come on for 1 second and then goes off.\par
Wait for a minute\par
Verify that no LEDs come on\par
Now in IDLE state\par
}
</Description>
      <Notes />
      <ContentValue>O6gNPoJdVLMHsdQDhPPaYA</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00009</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Monitor State Fail And Recovery Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test verifies that when the Eton Firmware PCBA is in the MONITOR state, if a leak is present for only a short time, it will not cause a failure. The test also verifies that if a leak is present for a longer time, it will cause a failure. In addition, the test also checks that a Short Button Press in the FAULT state will start a pump down sequence.\par
Test Sequence\par
MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )  Brief leak present, MONITOR continues  Brief leak repaired, MONITOR continues  Short Button Press  STATUS (\lquote Indicate Status\rquote )  (Leak Detected)  STATUS (\lquote Indicate Fail\rquote )  FAULT  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 14 14  11  15  8  14.\par
Prerequisites\par
This test must be performed with the Pico test dressing, attached to the Perspex sheet (i.e. no reservoir).\par
This is due to the fact that the Pico test dressing with large reservoir (i.e. 400ml capacity) causes a gross leak rate that is outside of the design limit of a maximum leak of 12 ml/min.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Run test: \ldblquote 3.2.2 \{SysTst_Manual-00001\} Idle State Pump Down Test\rdblquote  to bring the system into the MONITOR state.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
To Verify the system is in the MONITOR state, perform a short press on the OK button.\par
The green LED will turn ON for two seconds\par
Cause a leak by disconnecting the Tube connecter attached to the Eton Firmware PCBA for approximately 2 seconds.\par
You should hear pump start to pump\par
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.\par
Verify that no LEDs come on\par
To Verify still in MONITOR state, perform a short press on the OK button.\par
The green LED will turn ON for two seconds\par
Disconnect the Tube connecter attached to the Eton Firmware PCBA for approximately 10 seconds.\par
You should hear pump start to pump\par
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Verify a leak has been detected\par
Now in FAULT state\par
Since pressure is not met then the amber LED will come on for 2 seconds and then goes off.\par
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.\par
Start pump down again, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait for 20 seconds\par
After the pump down sequence the green LED will come on for 2 seconds and then goes off\par
Verify acoustically that the pump stops\par
(Should now be in the MONITOR state)\par
Perform a short press on the OK button.\par
The green LED will turn ON for two seconds\par
}
</Description>
      <Notes />
      <ContentValue>xguiZyrrEW6Q2YTOI0LwnA</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00010</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Verify Repeated Pump Down Retries When Leak is Present</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This verifies that the system repeatedly attempts pump downs if there is a leak and will perform a successful pump down when the leak is fixed.\par
Test Sequence\par
FAULT  Fault Time-out 60 minutes  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Leak Detected (Failed to reach pressure)  STATUS (\lquote Indicate Fail\rquote )  FAULT,\par
The above sequence repeats every Fault Time-out 60 minutes for a minimum of 3 hours until the dressing is connected prior to a pump down attempt. Then the following sequence occurs.\par
FAULT  Fault Time-out 60 minutes  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 16  5  16, repeats every Fault Time-out 60 minutes for a minimum of 3 hours until the dressing is connected prior to a pump down attempt. Then the following State change sequence occurs.\par
16  8  14.\par
Prerequisites\par
Clear the log buffer. See Appendix C - Clearing the Eton Firmware PCBA EEPROM Contents, for instructions.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Run test \ldblquote 3.2.4 \{SysTst_Manual-00003\} Idle State Pump Down Fail Test\rdblquote  to bring the system into the FAULT state.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Leave the Eton Firmware PCBA in a FAULT state for at least 3 hours.\par
Record the Start and End times of the test in the test log.\par
The amber LED will continue to flash and on each hour an attempt will be made at a pump down.\par
Encapsulate the dressing.\par
Verify that after the next hour a pump down will be attempted which is successful.\par
Perform a short press on the OK button.\par
Verify the green LED comes on for 2 seconds and then goes off.\par
Verify Repeated Pump Down Retries When Leak is Present Test, Log Buffer Verification\par
Follow the procedure in Appendix B - Uploading Eton Firmware PCBA EEPROM Contents, to upload the log buffer and verify that the test events are as expected.\par
In addition to the steps described in Appendix B - Uploading Eton Firmware PCBA EEPROM Contents, the following filtering steps should be performed in the results (.xlsx) file.\par
(Note that the results (.xlsx) file recorded from a previous test cycle may be used as a template).\par
Filter the Log Buffer by the \lquote LEAK\rquote  state field and \lquote External Pressure\rquote  field when non-zero in order to obtain the log entries when a pump down attempt is being made. (Note that the Log Buffer currently uses the term \lquote LEAK\rquote  for the \lquote FAULT\rquote  state).\par
Add a new column that calculates the difference in minutes between each pump down attempt. (I.e. Column Heading \lquote Time From Last Pump Down Attempt (min)\rquote ).\par
In the \lquote Time From Last Pump Down Attempt (min)\rquote  column input a formula that calculates the time between pump down attempts. (I.e. subtract the last \lquote Time (min)\rquote  value from the next \lquote Time (min)\rquote  value). This should give results of approximately 60 minutes between pump down attempts. See Figure 1 below for an example of filtered results.\par
Figure 1: Time from Last Pump Down Attempt Screenshot\par
Note the time between Pump Down Attempts in the test log. This time should match the time observed in test 3.2.11.3 for attempted pump downs.\par
Filter the results so that the time when the MONITOR state is successfully entered is shown and note the Time (min)\rquote  in the test log. This is the time in minutes that the Eton Firmware PCBA was in the FAULT state before the dressing was re-connected and MONITOR state entered. This time should match the time recorded in test 3.2.11.3 as the test time. See Figure 2 below for an example of filtered results.\par
Figure 2: Time in FAULT State Screenshot\par
Store the screenshots of the filtered results in the test log.\par
Store the log buffer in the test log.\par
}
</Description>
      <Notes />
      <ContentValue>10mWkP6SpnGJdhh2N7S71Q</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00012</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface|Test Cases – State Transition</Address>
      <Title>Soak Testing</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This will test the system overnight with a connected dressing.\par
Test Sequence\par
MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote ).\par
State change matrix: 14.\par
Prerequisites\par
Clear the log buffer. See Appendix C - Clearing the Eton Firmware PCBA EEPROM Contents, for instructions.\par
Run test \ldblquote 3.2.2 \{SysTst_Manual-00001\} Idle State Pump Down Test\rdblquote  to put the PCBA into the MONITOR state.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Leave the Eton Firmware PCBA overnight.\par
Record the Start and End times of the test in the test log.\par
While being viewed no LEDs should come on,\par
Perform a short press on the OK button.\par
Verify the green LED comes on for 2 seconds and then goes off.\par
Soak Testing Test, Log Buffer Verification\par
Follow the procedure in Appendix B - Uploading Eton Firmware PCBA EEPROM Contents, to upload the log buffer and verify that the test events are as expected.\par
In addition to the steps described in Appendix B - Uploading Eton Firmware PCBA EEPROM Contents, the following filtering steps should be performed in the results (.xlsx) file.\par
(Note that the results (.xlsx) file recorded from a previous test cycle may be used as a template).\par
Filter the Log Buffer by the \lquote THERAPY_DELIVERY\rquote  and \lquote SLEEP\rquote  state field in order to obtain the last log entry when in the \lquote THERAPY_DELIVERY\rquote  state and note the Time (min)\rquote  in the test log. (Note that the Log Buffer currently uses the term \lquote THERAPY_DELIVERY\rquote  for the \lquote MONITOR\rquote  state). This is the time in minutes that the Eton Firmware PCBA was in the MONITOR state. This time should match the time recorded in test 3.2.12.3 as the overnight test time. See Figure 3 below for an example of filtered results.\par
Figure 3: Time in MONITOR State Screenshot\par
Store the screenshot of the filtered results in the test log.\par
Store the log buffer in the test log.\par
}
</Description>
      <Notes />
      <ContentValue>py0d3IMb62qeUmBcNCZPIw</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00014</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface</Address>
      <Title>Detailed Timing Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test will perform detailed timings of the various LED sequences to verify they are within acceptable tolerances.\par
Test Sequence\par
IDLE  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN\par
State change matrix: 1.\par
Prerequisites\par
This test must be performed with the Eton Firmware PCBA marked with label \ldblquote S1725-2\rdblquote . The Eton Firmware PCBA should be setup using the procedure in Appendix D - Timing Test.\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
The Eton Firmware PCBA is in the IDLE state.\par
LED Test Pattern Sequence Limitation\par
The Eton Firmware PCBA marked with label \ldblquote S1725-2\rdblquote  used for the timing tests, unfortunately cannot connect to a Pico test dressing since there is no Tube connecter attached to the device. Consequently, a successful pump down sequence cannot be performed and a number of LED test pattern sequences cannot be produced and as a result cannot be tested.\par
Therefore, the timing tests are restricted to confirmation of the 100 ms timing interval used in generating all LED test pattern sequences.\par
Timing Tolerance\par
The tolerance of all timings as specified by the UIRS, reference [1] is \'b1 10%.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Monitor the Amber and Green LED test signals as specified in Appendix D - Timing Test, on an oscilloscope.\par
Capture the LED test pattern sequence.\par
To Start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
For the captured LED test pattern sequence, measure the 100 ms timing interval.\par
The timing interval = 100 ms \'b1 10%.\par
Record the results in the test log.\par
}
</Description>
      <Notes />
      <ContentValue>7U7WvED+BaRF+8Je4qgbZA</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00015</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface</Address>
      <Title>Power Consumption Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test will verify the current consumption in a number of different states as described in section 3.4.1.1.\par
In addition, the test also verifies the UIRS 01040 and UIRS 03050 requirements.\par
Test Sequence\par
Test Case 1: When the system is powered up but the tab has not been pulled.\par
Measurement State: IDLE.\par
Test Case 2: When the system is powered up but the tab has not been pulled and after the button has been pressed.\par
Measurement State: IDLE.\par
Test Case 3: Power consumption when the tab has been pulled but before the button is pressed.\par
Measurement State: IDLE.\par
Test Case 4: Power consumption when the tab is pulled and monitor state entered and paused.\par
Measurement State: IDLE.\par
Test Case 5: Power consumption over a period of time when in the MONITOR state. This test will involve using a digital storage scope to capture current pulses when the pump is on and estimating the current consumed for those pulses over a period of time. (I.e. using the measured current, pulse width and number of pulses to provide an estimate for the overall current consumption).\par
Measurement State: MONITOR\par
Prerequisites\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
The Eton Firmware PCBA should be setup using the procedure in Appendix E - Power Consumption Test.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Verify Eton Firmware PCBA current consumption for the following condition.\par
When the system is powered up but the tab has not been pulled.\par
Perform Measurement 1: Eton Firmware PCBA Supply Current, using the procedure described in section E.2 Eton Firmware PCBA Supply Current Measurement.\par
Record the result in the test log.\par
Perform Measurement 2: Eton Firmware PCBA +3V Supply Current, using the procedure described in section E.3 Eton Firmware PCBA +3 V Supply Current Measurement.\par
Record the result in the test log.\par
Verify that the measured values are within the acceptable ranges as follows:\par
Verify that Measurement 1 is &lt;= 50 \'b5A.\par
Verify that Measurement 2 is &lt;= 100 nA.\par
Perform a short press on the OK button.\par
This test step verifies the UIRS 03050 \lquote Pump Down to Standby\rquote  requirement.\par
Verify that no LEDs come on.\par
Perform a long press on the OK button.\par
This test step verifies the UIRS 01040 \lquote Absence of long press action\rquote  requirement.\par
Verify that no LEDs come on.\par
Verify Eton Firmware PCBA current consumption for the following condition.\par
When the system is powered up but the tab has not been pulled and after the button has been pressed.\par
Press and hold the OK button.\par
Perform Measurement 1: Eton Firmware PCBA Supply Current, using the procedure described in section E.2 Eton Firmware PCBA Supply Current Measurement.\par
Record the result in the test log.\par
Perform Measurement 2: Eton Firmware PCBA +3V Supply Current, using the procedure described in section E.3 Eton Firmware PCBA +3 V Supply Current Measurement.\par
Record the result in the test log.\par
Release the OK button.\par
Perform Measurement 1: Eton Firmware PCBA Supply Current, using the procedure described in section E.2 Eton Firmware PCBA Supply Current Measurement.\par
Record the result in the test log.\par
Perform Measurement 2: Eton Firmware PCBA +3V Supply Current, using the procedure described in section E.3 Eton Firmware PCBA +3 V Supply Current Measurement.\par
Record the result in the test log.\par
Verify that the measured values are within the acceptable ranges as follows:\par
Verify that Measurement 1 whilst the button is pressed is &lt;= 5 mA.\par
Verify that Measurement 1 after the button is released is &lt;= 20 \'b5A.\par
Verify that Measurement 2 whilst the button is pressed is &lt;= 5 mA.\par
Verify that Measurement 2 after the button is released is &lt;= 100 nA.\par
Verify Eton Firmware PCBA current consumption for the following condition.\par
When the tab has been pulled and in the IDLE state but before the button is pressed.\par
Perform Measurement 1: Eton Firmware PCBA Supply Current, using the procedure described in section E.2 Eton Firmware PCBA Supply Current Measurement.\par
Record the result in the test log.\par
Perform Measurement 2: Eton Firmware PCBA +3V Supply Current, using the procedure described in section E.3 Eton Firmware PCBA +3 V Supply Current Measurement.\par
Record the result in the test log.\par
Verify that the measured values are within the acceptable ranges as follows:\par
Verify that Measurement 1 is &lt;= 100 \'b5A.\par
Verify that Measurement 2 is &lt;= 100 \'b5A.\par
Verify Eton Firmware PCBA current consumption for the following condition.\par
When the tab is pulled and monitor state entered and paused.\par
To Pause the monitor, perform a long press on the OK button.\par
Perform Measurement 1: Eton Firmware PCBA Supply Current, using the procedure described in section E.2 Eton Firmware PCBA Supply Current Measurement.\par
Note: The current measurement may alternate between two different values representing two different conditions of the MCU operation.\par
Record the two results (i.e. the alternating lower and higher readings) in the test log.\par
Perform Measurement 2: Eton Firmware PCBA +3V Supply Current, using the procedure described in section E.3 Eton Firmware PCBA +3 V Supply Current Measurement.\par
Note: The current measurement may alternate between two different values representing two different conditions of the MCU operation.\par
Record the two results (i.e. the alternating lower and higher readings) in the test log.\par
Verify that the measured values are within the acceptable ranges as follows:\par
Verify Measurement 1 as follows:\par
Lower reading &lt;= 1 mA.\par
Higher reading &lt;= 2 mA.\par
Verify Measurement 2 as follows:\par
Lower reading &lt;= 1 mA.\par
Higher reading &lt;= 2 mA.\par
Verify Eton Firmware PCBA current consumption for the following condition.\par
Over a period of time when in the MONITOR state.\par
Estimate the Eton Firmware PCBA Power Consumption for the MONITOR state, using the procedure described in section E.4. Eton Firmware PCBA MONITOR State Power Consumption Estimation\par
Record the result in the test log.\par
Verify that the estimated Eton Firmware PCBA power consumption in the MONITOR state is below the maximum power budget as follows:\par
Verify that the estimated Eton Firmware PCBA power consumption in the MONITOR state is &lt;= 1512 mAh.\par
}
</Description>
      <Notes />
      <ContentValue>F1lNhxiB13BftjF+SgjBLQ</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00016</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface</Address>
      <Title>NRE Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA\rquote s handling of hardware errors.\par
Test Sequence\par
MONITOR  NRE State change. Test Steps #1 to #9.\par
MONITOR  NRE Battery Life End (EOL)  Short Button Press, NRE continues  Short Button Press, NRE continues  Long Button Press, NRE continues  Long leak present, NRE continues  Long leak repaired, NRE continues  Long leak present, Fault Time-out 60 minutes, NRE continues  Long leak repaired, NRE continues  Eton Firmware PCBA Power down, test end.\par
State change matrix: 13  19.\par
PUMP DOWN  NRE State change. Test Steps #11 to #20.\par
IDLE  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  NRE Battery Life End (EOL)  Short Button Press, NRE continues  Short Button Press, NRE continues  Long Button Press, NRE continues  Long leak present, NRE continues  Long leak repaired, NRE continues  Long leak present, Fault Time-out 60 minutes, NRE continues  Long leak repaired, NRE continues  Eton Firmware PCBA Power down, test end.\par
State change matrix: 1  9  19.\par
Prerequisites\par
\lquote Power level is good\rquote\par
\lquote Dressing Connected\rquote .\par
Run test: \ldblquote 3.2.2 \{SysTst_Manual-00001\} Idle State Pump Down Test\rdblquote  to bring the system into the MONITOR state.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
While the Eton Firmware PCBA is in the MONITOR state, set each of the two bench Power Supply Units to +1.0 V.\par
This arrangement satisfies the SRS 02420 NRE Event Detection criteria.\par
The Eton Firmware PCBA is now in the NRE state.\par
Perform a short press on the OK button.\par
Verify that no LEDs come on.\par
Perform a short press on the OK button.\par
Verify that no LEDs come on.\par
Perform a long press on the OK button.\par
Verify that no LEDs come on.\par
Cause a leak by disconnecting the Tube connecter attached to the Eton Firmware PCBA for at least 20 seconds..\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Disconnect the the Tube connecter attached to the Eton Firmware PCBA.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
To check that the pump down does not automatically restart after an hour,\par
Wait for 1 hour\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Switch the two bench Power Supply Units OFF.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
To recover the Eton Firmware PCBA, perform the procedure in section 2.6 Initial Eton Firmware PCBA IDLE State.\par
The Eton Firmware PCBA is in the IDLE state.\par
To start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait 2 seconds and then while the Eton Firmware PCBA is in the PUMP DOWN state, set each of the two bench Power Supply Units to +1.0 V.\par
This arrangement satisfies the SRS 02420 NRE Event Detection criteria.\par
The Eton Firmware PCBA is now in the NRE state.\par
Perform a short press on the OK button.\par
Verify that no LEDs come on.\par
Perform a short press on the OK button.\par
Verify that no LEDs come on.\par
Perform a long press on the OK button.\par
Verify that no LEDs come on.\par
Cause a leak by disconnecting the Tube connecter attached to the Eton Firmware PCBA for at least 20 seconds.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Disconnect the Tube connecter attached to the Eton Firmware PCBA.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
To check that the pump down does not automatically restart after an hour,\par
Wait for 1 hour\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Reconnect the Tube connecter attached to the Eton Firmware PCBA and Wait for one minute.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
Switch the two bench Power Supply Units OFF.\par
The pump should not start pumping.\par
Verify that no LEDs come on.\par
To recover the Eton Firmware PCBA, perform the procedure in section 2.6 Initial Eton Firmware PCBA IDLE State.\par
The Eton Firmware PCBA is in the IDLE state.\par
}
</Description>
      <Notes />
      <ContentValue>Cy+brzE5pH/GTKciV5brIg</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>SysTst_Manual-00017</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Test Specification|Testing User and Pump Interface</Address>
      <Title>NRV Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA\rquote s handling of NRV errors.\par
Test Sequence\par
PUMP DOWN  FAULT (NRV Block) State change. Test Steps #1 to #10.\par
IDLE  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Exhaust Hole blocked, STATUS (\lquote Indicate Fail\rquote )  FAULT (NRV Block)  STATUS (\lquote Indicate Fault\rquote )  Exhaust Hole cleared, FAULT continues  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 1  6  15  8.\par
MONITOR  FAULT (NRV Block) State change. Test Steps #11 to #17.\par
MONITOR  Exhaust Hole blocked, STATUS (\lquote Indicate Fail\rquote )  FAULT (NRV Block)  STATUS (\lquote Indicate Fault\rquote )  Exhaust Hole cleared, FAULT continues  Short Button Press  STATUS (\lquote Indicate Activate\rquote )  PUMP DOWN  Pressure Achieved, STATUS (\lquote Indicate Success\rquote )  MONITOR  Short Button Press  STATUS (\lquote Indicate Status\rquote )\par
State change matrix: 12  15  8.\par
Prerequisites\par
\lquote Power level is good\rquote .\par
\lquote Dressing Connected\rquote .\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Follow the procedure in section 2.6 to put the Eton Firmware PCBA in the IDLE state.\par
The Eton Firmware PCBA is in the IDLE state.\par
To start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait 2 seconds and then block the Exhaust Hole by securing insulating tape over the two holes below the OK button.\par
(Note: It may be possible to block the Exhaust Hole by alternative methods and it is left at the discretion of the Tester to select a suitable method. E.g. it was found that covering the two holes below the OK button with a finger was also effective).\par
The green LED will continue to flash the pump down sequence\par
Wait for the Eton Firmware PCBA to detect an NRV Blockage Fault.\par
Now in FAULT state\par
Since NRV blockage detected the amber LED will come on for 2 seconds and then goes off.\par
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.\par
Wait for a minute\par
Verify the amber LED continues to flash.\par
Remove the blockage over the two holes below the OK button. (I.e. The Exhaust Hole).\par
Verify the amber LED continues to flash.\par
To start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait 20 seconds\par
After the pump down sequence the green LED will come on for 2 seconds and then goes off\par
Verify acoustically that the pump stops\par
Wait for a minute\par
Verify that no LEDs come on.\par
Now in MONITOR state\par
To Verify that the status works, perform a short press on the OK button.\par
The green LED will come on for two seconds and then goes off.\par
Block the Exhaust Hole by securing insulating tape over the two holes below the OK button.\par
(Note: It may be possible to block the Exhaust Hole by alternative methods and it is left at the discretion of the Tester to select a suitable method. E.g. it was found that covering the two holes below the OK button with a finger was also effective).\par
Verify that no LEDs come on.\par
Wait for the Eton Firmware PCBA to detect an NRV Blockage Fault.\par
Now in FAULT state\par
Since NRV blockage detected the amber LED will come on for 2 seconds and then goes off.\par
It will then start to continuously flash on for 0.2s and then off for 1.8 seconds.\par
Remove the blockage over the two holes below the OK button. (I.e. The Exhaust Hole).\par
Verify the amber LED continues to flash.\par
To start a pump down, perform a short press on the OK button.\par
The pump will come on and start pumping.\par
The green LED will come on for a second.\par
The green LED will start flashing the pump down sequence\par
Wait 20 seconds\par
After the pump down sequence the green LED will come on for 2 seconds and then goes off\par
Verify acoustically that the pump stops\par
Wait for a minute\par
Verify that no LEDs come on.\par
Now in MONITOR state\par
To Verify that the status works, perform a short press on the OK button.\par
The green LED will come on for two seconds and then goes off.\par
}
</Description>
      <Notes />
      <ContentValue>HvJeFwAN01YTBjjpaAVQ4Q</ContentValue>
      <ModifiedVersion>B</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00002</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION</Address>
      <Title>Power Management</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The Eton device has two main power modes, the first is the deep sleep mode which is active when the device is first powered and up to the time when the device is activated by pulling the tab and switching the device on. This gives the maximum power saving for when the device is in storage before it is used.\par
The second is the therapy power management when therapy has been started. This includes a power saving sub state to allow the device to sleep when no pumping is taking place.\par
Deep Sleep Mode\par
The Eton software provides a deep sleep (i.e. HALT) mode where the MCU is completely halted. This is triggered within the IDLE state of the State Machine, and for testability reasons, wrapper functions for MCU specific instructions are provided in PowerControl.c and PowerControl.h.\par
During the deep sleep the MCU peripherals and the ALU are deactivated (Consequently, the Timer 1 peripheral is also halted).\par
The deep sleep mode is entered when:\par
The power to the MCU is applied for the first time (or after system reset), and the ICT POST state is not activated\par
The button switch is pressed for &gt;200ms when the device is in IDLE, and the application detects that the pull tab is in place (this takes 10 seconds)\par
The software will not be able to exit the deep sleep mode apart from after a power cycle with the ICT POST I/O pins deactivated, followed by a button press for &gt;200ms with the pull tab being removed.\par
Once the application has been successfully started for the first time, the deep sleep mode will never be entered again (unless the device is started with the pull tab in place which generates an Out-of-Range Voltage error during Initial Pump Down).\par
Note: The only way to waken the system from deep sleep mode is to press the button. There will be no timers running.\par
Therapy Power Management\par
When therapy is started the device will stay awake all the time with the one exception documented in the power saving state below. In this mode, when the processing for the 100ms schedule has been completed, the system will simply loop round and wait for the next 100ms tick to occur.\par
However, the Eton software minimizes the power consumption with the following approach:\par
In IDLE state (when not in deep sleep mode), all the external peripherals and the main power circuit are disabled\par
In Fault (e.g. LEAK) state, all the external peripherals are disabled\par
In NRE (Non-Recoverable Error) state, all the external peripherals and the main power circuit are disabled\par
At the end of each execution cycle, the application disables all the peripherals that are not in use\par
Power Saving State\par
In Therapy Maintenance State pumping only takes place once a second so that in 1 of the 100ms ticks the pressure is read and in the next the pump is switched on if required. This leaves 8 of the ticks which are effectively wait states. In order to save power during these states the system switches Timer 1 to use the internal 31 KHz clock and re-calculates the timeouts. The processor then goes to sleep during these ticks to save power.\par
}
</Description>
      <Notes />
      <ContentValue>e1rmPSw1r0htkdoqJnXMSw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00003</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|APPLICATION</Address>
      <Title>Watchdog</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The internal watchdog of the PIC16LF1509 MCU is used by this module, and is configured via the MPLAB MCC. The module is implemented in Watchdog.c and Watchdog.h, and provides a function to initialise the watchdog and another to kick it. The module initialises the watchdog to have a timeout of 512ms. An advisory note for Debug builds, it was found that the watchdog did not function correctly when the MCU was in debug mode (since halting at a breakpoint would cause the MCU to reset), therefore this module mustn't be compiled in when the software is built in debug mode with the intent of using software breakpoints.\par
The watchdog initialisation routine is called at the start of the initialisation routine for the application. This ensures that any failure when initialising the other software modules will be caught by the watchdog.\par
The watchdog kick routine is called at the end of every 100ms system cycle. In deep sleep the watchdog is disabled.\par
}
</Description>
      <Notes />
      <ContentValue>5pa/SH2JU1dfRQbc3gw85w</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00004</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers</Address>
      <Title>Therapy State Machine</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The main operation of the device is governed by the operational therapy state machine as shown in Figure 4. It is responsible for starting/stopping therapy and ensuring that the correct therapy is delivered.\par
Figure 4, Device operational state machine\par
}
</Description>
      <Notes />
      <ContentValue>JQe9YtjseWsP5nbV3HSrCw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00005</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers</Address>
      <Title>State Machine Overview</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 For brevity the Therapy State Machine is also simply referred to as the State Machine. The System is deemed to be in the Therapy Active state if the state machine is in either the Initial Pump Down or the Therapy Maintenance state.\par
The main functions of the system are realised in the state machine as shown in Figure 4. The alert manager is responsible for controlling the LEDs. Each time the state machine changes state it requests alert manager to start to display the appropriate sequence which it will do as an independent task. These are shown as the \ldblquote on entry\rdblquote  arrows in the diagram. The exception to this is when the state machine enters the therapy state; here the previous pump sequence is allowed to continue. The therapy state then waits for the required pump down display to complete and displays the final one second of green LED which indicates success.\par
This is the default state when the device is hard reset. It consists of 6 immediate sub-states:\par
ICT POST\par
Idle (therapy paused or deep sleep)\par
Initial Pump Down (Initial pump down)\par
Therapy Maintenance or MPD state (therapy delivery)\par
Fault (recoverable error)\par
Power Down (intermediate step to Idle)\par
NRE (non-recoverable error)\par
NRV (Non return valve)\par
The Idle state consists in two sub-states: Deep Sleep where the\par
MCU is halted and wakes up only to a button switch press; Pause where the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off.\par
State\par
Description\par
Initial Pump Down (IPD)\par
This state is entered after a user start or an automatic restart. Therapy is started.\par
Every 100ms the system will alternate between reading the pressure and pumping if the target pressure has not been met.\par
If an out of range voltage error occurs the device will transit to the Idle state.\par
After 20 seconds a timeout will occur and if at any time during the previous 5 seconds the target pressure has been reached then the system will transit to the Therapy Maintenance state otherwise it will transit to the Fault state.\par
Therapy Maintenance (MPD)\par
In this state, the optimal set point pressure is achieved and maintained by running the pump when more negative pressure is required and stopping it when the target has been reached. The pump duty cycle is calculated to evaluate whether there is a leak condition.\par
If a leak is detected, the corresponding leak flag is set to allow the alert manager to alert the user. If the leak is not remedied before a timeout, then the device will transit back to Initial Pump Down attempting again to deliver therapy. This auto restart mechanism is in place to avoid therapy not being delivered as result of the user to accidentally switching the device off.\par
IDLE\par
(deep sleep)\par
In this state, MCU is halted and wakes up only after a button press. The state is entered on one of the following conditions being met::\par
The device has been powered on and the ICT POST state is skipped (i.e. ICT pins not configured for testing).\par
The device has been activated with Pull tab still in place. Here a pump down will be attempted but a \ldblquote Voltage out of Range\rdblquote  error will occur and the system will return to the deep sleep IDLE state.\par
IDLE\par
(pause)\par
In this state, the MCU is executing the program in order to keep track of the elapsed time but all the peripherals are switched off. It is entered due to one of the following conditions:\par
The therapy has been pauseddue to a long button press.\par
FAULT\par
(recoverable error)\par
In this state, the MCU is executing the program in order to keep track of the elapsed time, all the peripherals apart from the LED's power circuit are switched off. It is entered due to the following conditions:\par
A recoverable error (e.g. Leak) has occurred in any of the Therapy Active states.\par
An NRV blockage has taken place. Something has blocked the exhaust valve on the front and air cannot be expelled correctly.\par
FAULT\par
(non-recoverable error)\par
This is a trap state that cannot be exited other than by cutting the power off to the device (i.e. disconnecting the batteries)\par
This state is entered when:\par
The device reaches End of Life (EOL) in any of the Therapy Active states.\par
The log buffer has reached the number of logged records which indicates that the system has been active for a full 7 days.\par
Integrated Circuit Test\par
POST\par
This state is used to receive commands from the Factory Circuit Acceptance Test tool during Factory Acceptance Test. It is entered when:\par
The ICT pins are configured for Factory testing by the ICT tool and the device is power cycled\par
The device needs to be power-cycled and the ICT tool needs to release the control of the ICT pins to resume normal operation (see "HET-17-0221-D_E /CT Test Requirement, Specification")\par
Table 2, Operational States\par
Pump Down Logic\par
The following section details the pump down logic when the pump is initially started and an attempt is made to attain the initial pump down pressure.\par
Figure 5, Pump Down timeline\par
The operation allows a limited time (currently 20 seconds) of alternated pump activation and vacuum pressure reading operations every 100ms. The two operations are mutually exclusive because the pressure readings could be affected by the noise produced by the piezo pump. An example of the timeline for the internal operations during pump down is provided in Figure 5.\par
The target vacuum pressure for the initial pump down is -96 mBar that is the minimum vacuum required to guarantee that therapy is delivered. If at the end of the 20 seconds the target pressure has not been reached within the last 5 seconds of the 20 seconds the state machine will transition to Fault state.\par
Each time the pump is activated during the initial pump down, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.\par
Priority\par
(1-highest)\par
Error\par
New state\par
Description\par
1\par
External pressure is 30 mBar greater than the initial pressure\par
Fault\par
When the pump down is first started the external pressure is read. If during the rest of the pump down the external pressure exceeds the initial read plus 30 mBar then the system transits to fault.\par
This scenario indicates that the external valve has been blocked.\par
2\par
Piezo Pump frequency out of range\par
Fault\par
The piezo pump is faulty because the optimum frequency has fallen out of the working range.\par
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.\par
3\par
Boost Converter voltage out of range\par
IDLE (deep sleep)\par
This error is detected if the pull tab has not been removed and the device has been accidentally activated. As result the software goes in IDLE deep sleep state (i.e. HALT mode, no automatic restarts) so that the device is switched to its lowest possible consumption power preserving its shelf life.\par
Note that a faulty Boost converter would cause the same error but it is not possible to distinguish this from the puII tab in place condition. In order to preserve the battery we need to treat this case like an accidental activation.\par
4\par
Battery depleted\par
NRE\par
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.\par
5\par
Unsuccessful pressure reading\par
Fault\par
Failing to successfully acquire vacuum pressure measurements throughout the IPD period does eventually lead to a time out without reaching target pressure.\par
Table 3, IPD errors triggering a state transition\par
Therapy Maintenance Logic\par
The Therapy Maintenance (MPD) state aims to maintain a target vacuum within its acceptable levels (i.e. [-96,-106] mBar). This is achieved by scheduling operations in 1 second slots (see Figure 6) as follows:\par
Measuring the actual vacuum during the first 100ms of the 1 second slot Keep a rolling buffer of whether or not the pump was on every second (see Ref. [1])\par
Activating the pump if needed during the second 100ms of the 1 second slot\par
Do nothing in the next 800ms to save the battery power.\par
Figure 6, Therapy Maintenance timeline\par
The Therapy state applies a number of checks making sure an acceptable vacuum can be successfully maintained without incurring an excessive use of the battery power. These checks take place during either the vacuum reading or the pump activation (100ms) slot, they have a different periodicity, are enabled or disabled depending on their objective and battery status (see Table 4). These checks are described in more details in the Device modules that implement them, are:\par
Vacuum Reading validation:\par
check if valid vacuum readings can be successfully acquired (see section 3.5.11)\par
Fault detection:\par
based on the history of the pump activation duty cycle, check if a gross leak has occurred in the system (see section 3.5.11)\par
Target Vacuum update:\par
based on the history of the pump activation duty cycle, adjust the target vacuum to optimise working conditions (higher vacuum with lower battery use, see section 3.5.11)\par
Pump Frequency update:\par
based on the pump current draw, adjust the target PWM frequency to optimise the piezo pump efficiency (see section 3.5.9)\par
Boost Converter OutputVoltage check:\par
adjust the demand from the Boost Converter based on its actual output voltage (see section 3.5.5)\par
Battery output Voltage check:\par
monitor the battery status to adjust the schedule the device operations for maximum life cycle (see section 3.5.5)\par
Functionality\par
Execution Phase\par
Period(s)\par
Status if battery is depleting\par
(i.e. Boost Converter output Voltage &lt;MAX)\par
Vacuum Reading validation\par
READ VACUUM\par
(PUMP OFF)\par
1\par
enabled\par
Leak detection\par
READ VACUUM\par
(PUMP OFF)\par
1\par
disabled\par
Target Vacuum update\par
READ VACUUM\par
(PUMP OFF)\par
9\par
disabled\par
Pump Frequency update\par
PUMP ON\par
&gt;=1\par
enabled\par
Boost Converter output Voltage check\par
PUMP ON\par
&gt;=1\par
enabled\par
Battery output voltage check\par
PUMP ON\par
&gt;=1\par
enabled\par
Table 4, Therapy Maintenance main operations during Pump ONphases\par
Each time the pump is activated during the therapy maintenance, the application monitors that the battery, boost converter, external pressure and the pump frequency control operate at the expected levels. If any of these checks fails, the application generates one of the following errors and state transitions in order of priority.\par
Priority\par
(1-highest)\par
Error\par
New state\par
Description\par
1\par
External pressure is 30 mBar greater than the initial pressure read at pump down\par
Fault\par
If the external pressure exceeds the initial external pressure read during pump down plus 30 mBar then the system transits to fault.\par
This scenario indicates that the external valve has been blocked.\par
2\par
Piezo Pump frequency out of range\par
Fault\par
The piezo pump is faulty because the optimum frequency has fallen out of the working range\par
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.\par
3\par
Boost Converter voltage out of range\par
Fault\par
Unlike IPD, this error will unequivocally indicate an issue with the boost converter because the pull tab must have already been removed for the application to enter the MPD state.\par
It could be a temporary fault therefore the state machine goes into its recoverable error state for manual or automatic restart.\par
4\par
Battery depleted\par
NRE\par
The battery has reached too low a level to support the correct therapy delivery. The device has reached its end of life.\par
5\par
Unsuccessful pressure reading\par
Fault\par
Failing to successfully acquire vacuum pressure measurements throughout the MPD period does eventually cause a time out without reaching target pressure\par
Table 5, MPD errors triggering a state transition\par
}
</Description>
      <Notes />
      <ContentValue>5C9iklMUksPtxKph4/CQEw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00006</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers</Address>
      <Title>Alert Manager</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The alert manager controls the switching of the LEDs on the board. The corresponding GPIO pin for each LED is defined in LED.c and pin_manager.h modules. There are 2 LEDs:\par
1. Green LED\par
2. Orange LED\par
Each LED can either be off, flashing or on continuously. The status of the LEDs is updated every time the Alert Manager runs (i.e. 100ms interval), which means the higher frequency for a flashing (on) alert is 10Hz. This also guarantees that any temporary noise on the LED GPIO pins is mitigated by their status refresh being carried out at the highest possible frequency the application can run.\par
The Alert Manager runs before the State Machine during each application execution cycle. If the execution of the state machine results in a state change then a call is made to the alert manager to initiate the new sequence this ensures that the LED settings are up to date with the current state.\par
The total list of alerts and the mapping of their influences upon the respective LEDs can be found in Software Requirements Specification reference [2].\par
Note: The internal state machine for the Alert Manager does not map one-to-one with the states in the State Machine manager. This is because some of the alerts specified patterns cover more than one state of the State Machine. The use of the Device Status provides the communication between the Alert Manager and the State Machine.\par
}
</Description>
      <Notes />
      <ContentValue>7iyvI0JZLT/xv/vUpnzu+Q</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00007</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers</Address>
      <Title>Logging Manager</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The logging manager facilitates the writing of some of the key performance indicators of the device produced by the application into an external EEPROM. As a result, the behaviour of the device may be analysed after it has been used.\par
This manager is executed as last of the managers within the application so it can capture the most up to date status of the application. As a result, this manager is called on by the application every tick (100ms) but it will write data to the EEPROM every 600 ticks (1 minute, which is determined using a count-down timer). In addition, the logging manager writes to the EEPROM in the first 100ms available slot after the 1 minute boundary when neither the pressure is read nor the pump is activated. This minimises the risk for the application business logic to take more than 100ms tick duration by not having to run too many lengthy operations within the same execution cycle. The following values are logged; see section 4 for format details.\par
Differential pressure:\par
Differential vacuum in millibar\par
External pressure:\par
External pressure in millibar\par
Pump Activation history:\par
History of the pump activation occurrences in the last 32 seconds (i.e. duty cycle)\par
Loaded battery voltage:\par
Battery voltage in millivolts during pump activation\par
Temperature:\par
Raw ADC reading of the internal temperature sensor\par
State Machine status:\par
Current state of the State Machine\par
Initial Pump Down Duration:\par
Time taken to first reach target pressure during the initial pump down.\par
Unloaded battery voltage:\par
Battery voltage in millivolts when there is no on-going operation\par
Each row of the EEPROM will hold the records for a specific minute allowing a history for more than 7 days. Once the Logging Manager detects that the EEPROM has been filled, logging will stop.\par
The logging manager may also be used to stream stored values to the UART as they are read so that these values are visible when connected to an external system. This is only used in a debug version.\par
}
</Description>
      <Notes />
      <ContentValue>8p9eQqM5j/xVKMq5RWf0Uw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00008</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|Managers</Address>
      <Title>Device Status</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The device status serves as a means for communication between the managers and the state machine or between states for specific aims (i.e. long button press propagation, Idle deep sleep mode transition). Managers and the state machine update or monitor the flags they are interested in and act upon the changes of the status whenever they are changed in the main application loop.\par
Status Flag\par
Description\par
Writer\par
Reader\par
Device State\par
Current state of the State Machine manager\par
State Machine\par
Alert Manager,\par
Logging Manager\par
Device State On Entry\par
Indicates if the State Machine is to run the current state for the first time (i.e.as result of state change.\par
State Machine\par
Test framework\par
LED status\par
Indicates if any of the LED is ON or OFF (if ON the main power circuit mustn\rquote t be disabled)\par
Alert Manager\par
State Machine\par
Therapy Status Check\par
Indicates the user needs to check (specific visual alert) if therapy is being delivered during maintenance.\par
State Machine\par
Alert Manager\par
Enter Deep Sleep\par
The device has detected one of the conditions triggering the state machine to go into Idle Deep. Sleep\par
State Machine\par
State Machine (Idle)\par
Button Press from Fault\par
Indicate that a manual restart has been started from fault and the long\par
press event has to be carried across IPD and MPD (rather than be reset as it usually happens during a state transition)\par
State Machine\par
Logging Manager\par
Pump Running\par
Indicates the Pump is running so any I2C operation should be avoided (e.g. Prevents the Logging Manager to write the device performances into non- volatile memory)\par
State Machine\par
Logging\par
Pressure being read\par
Indicates the pressure sensors are being read by the State Machine ,so any other I2C operation should be avoided (prevents the Logging Manager to write the device performances into non-volatile memory)\par
State Machine\par
Logging\par
Table 6, Device Status Flags\par
}
</Description>
      <Notes />
      <ContentValue>Qychppw1AxINe9CKfYbhnw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00009</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>C2 Ul lnterface</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Provides APIs to set and update the LED status and to detect button presses.\par
}
</Description>
      <Notes />
      <ContentValue>yWECYAPKLmLiI7Xu1OIVUQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00010</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>C3 LED</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Provides APIs to implement simple LED control which allows the LEDs to be switched ON and OFF or flashed at a constant frequency. This in turn calls the HW abstraction layer to configure the GPIOs pins which control the LEDs.\par
}
</Description>
      <Notes />
      <ContentValue>0N7OWAbP7tOmTfN/Ix6EAg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00011</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- LED Control Module</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The LED Control Module acts as an independent module within software architecture and is called at the tick interval of the scheduling system. Its interface allows for the LEDs to be switched on, off or flashed at various rates required by the application. There is also a feature which allows the detection of when some flash sequences have completed. The LED sequences are initiated in response to state changes of main FSM.\par
}
</Description>
      <Notes />
      <ContentValue>XJBRULKAyH0w7+A5XHKGsw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00012</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- LED Sequence (Alert Manager)</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The following sections document the LED sequences which will be provided by the alert manager. In addition to these sequences there will be a function which allows the LEDs to be turned off and also a function which can determine if a previously activated sequence has completed. The alert manager will have its own application level timer.\par
LED Pump Down Sequence\par
The following table shows the LED sequence which activated when the pump down sequence is started.\par
Units are 100mS.\par
Pumpdown_LED_Sequence - This will encompass phase 1 to phase 3. A flag will be set to indicate that this sequence has completed.\par
Show success - This will be used to put the green LED on for 2 seconds. This is Phase 4 of the state shown below.\par
Phase\par
On Time\par
100mS\par
Off Time\par
100mS\par
Total Duration\par
Repeat\par
Count\par
Description\par
Phase 1\par
10\par
0\par
1s\par
LED on for a second\par
Phase 2\par
1\par
1\par
5s\par
LED flashes rapidly for 5 second\par
Phase 3\par
1\par
1\par
600ms\par
3\par
Phase 3 lasts for a total of 15 seconds with the flash rate slowing as follows.\par
Run the on/off sequence 3 times.\par
1\par
2\par
900ms\par
3\par
Off is increased by 1 after every 3 cycles.\par
1\par
3\par
1200ms\par
3\par
1\par
4\par
1500ms\par
3\par
Repeat for 15 secondsby which time pump down will timeout\par
If pressure has not been reached then the state will be changed by the main FSM\par
Phase 4\par
20\par
0\par
2s\par
This state puts the LED on for 2 seconds and then puts if off. This assumes that the pressure has been reached as the main FSM has not timed out.\par
Table 7 LED Pump Down Sequence\par
LED Status\par
The status sequence will be as follows.\par
Green LED Status\par
Orange LED Status\par
Duration\par
On\par
Off\par
1 second\par
Off\par
Off\par
Continuously\par
Table 8 LED Status Sequence\par
LED Power Down\par
The power down sequence will be as follows.\par
Green LED Status\par
Orange LED Status\par
Duration\par
On\par
Off\par
2 seconds\par
Off\par
On\par
1 second\par
Off\par
Off\par
Continuously\par
Table 9 LED Power Down Sequence\par
LED Fault\par
The leak sequence will be as follows.\par
Step\par
Green LED Status\par
Orange LED Status\par
Duration\par
1\par
Off\par
On\par
2 seconds\par
2\par
Off\par
On\par
.2 seconds\par
3\par
Off\par
Off\par
1.8 seconds\par
Table 10 LED Leak Sequence\par
Steps 2 and 3 are then repeated continuously until the leak state is terminated by timeout or by user intervention.\par
}
</Description>
      <Notes />
      <ContentValue>4HFet7VflbnTaqN3Cs2Mlw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00013</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>– C1 Battery Voltage</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Monitor the status of the battery and adjust the boost converter settings to guarantee a reliable therapy delivery operation and a smooth transition to the device end of life.\par
Checks the battery and boost converter voltage output are within their working range (i.e.&lt;3.6V and between 16V and 33V respectively). If this is not the case, the module produces a "VOLTAGE OUT OF RANGE" error and this happens, for example, when the pull tab is still in place producing a boost converter voltage output reading lower than 16 V (most likely close to 0 V).\par
The battery provides an initial output voltage of 3V supporting the boost converter to generate an output voltage of 27V when driving the pump. After usage when the battery voltage goes below a certain level (i.e. 2.2V) the boost converter will not reliably produce its maximum output. As a result this module implements an algorithm to decrease the required boost converter output. This prevents the system from attempting to work in unstable conditions and extends the life of the battery.\par
Battery Voltage\par
Boost Converter\par
Output setting\par
Conditions\par
&gt;=2.2V\par
27V\par
None\par
&lt;2.2V\par
(Previous Output -1V)\par
Every10 times the battery is detected as &lt;2.2V\par
&lt;2.2V\par
&gt;18V\par
END-OF_LIFE\par
(EOL)\par
Table 11, Boost Converter settings table\par
The module will decrease the requested boost converter output by 1V every time the balance between battery measurements below and above 2.2 V reaches 10. This means that the shortest time for the boost converter output to go from 27 to 18 V (i.e. 9 V) is 90 seconds (i.e. 9 x 10 x 1 second cycle) during Therapy Maintenance state. In reality this will take much longer because the pump is unlikely to be activated every 1s cycle based on the vacuum reading. The illustration of the behaviour is depicted in Figure 7.\par
Figure 7, Battery life Vs. Boost Converter output settings\par
}
</Description>
      <Notes />
      <ContentValue>LcnJ3KwKkHRvXTCfzWSjsA</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00014</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>– C4 Pump</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Enable and disable of the pump by adjusting its PWM configuration. Carry out a number of operations that are needed to guarantee the correct functioning of the device; drive the frequency of the pump piezo towards an optimum working condition, monitor the boost converter voltage and battery voltage outputs when the pump is activated.\par
This module is used by the Initial Pump Down and Monitor Delivery states of the State Machine and uses a number of device (i.e. Pump Frequency Tracker, Battery) and HW abstraction modules (i.e. Power Control).\par
}
</Description>
      <Notes />
      <ContentValue>c+J9bIMZ2wEbjtxX6OBFZg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00015</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- C9 Duty Cycle</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Calculate the duty cycle between Pump ON and OFF in the Therapy Maintenance state. During each second the pump will come on for 100ms if more pressure is need or stay off if pressure is not needed. The duty cycle is the ratio of the number of on seconds within a fixed period of n readings. This module uses a sliding window to keep track of the most recent pump activity history (e.g. last 32 seconds). That is every second when the vacuum is calculated the sliding window is shifted along and the new record added to the end.\par
The module also determines which portion of the duty cycle history is used to detect a gross leak condition; too frequent pump activation indicates the presence of a gross leak which the application cannot sustain without depleting the battery prematurely. In this case, if a maximum number of pump activations (i.e. &gt;15) in the defined gross leak detection window (i.e. 30 seconds) occurs, the State Machine will transition into a Fault state giving the user the opportunity to readjust the dressing and possibly resolve the unsustainable leak.\par
}
</Description>
      <Notes />
      <ContentValue>sNIAO8iWfa8ePB4GrumC2g</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00016</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- C5 Target Pressure Modification</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 In order to increase the products tolerance to leaks a system of variable target pressures is also used. This is achieved by monitoring the pump duty cycle, as per the last section see 3.5.7 but over the last 10 seconds. Ideally the application would maintain the vacuum at -107 mBar. However, if the pump duty cycle starts creeping up (without reaching a gross leak level, i.e. &gt;3 activations in the last 10 seconds), the application monitors it every 9 seconds and reduces (in 1mBar steps) the target vacuum so the pump will possibly activate less frequently (i.e. reducing the duty cycle), the battery consumption is preserved, and the therapy is still delivered at an acceptable level. This, for instance, could happen if the overall leak rate of the dressing has increased but only for a short amount of time. This behaviour works in reverse, which means the target vacuum is moved towards the -107 mBar should the pump duty cycle fall below the same threshold.\par
}
</Description>
      <Notes />
      <ContentValue>4t0wlVthEkZQKbqWszkOqw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00017</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- C10 Pump Frequency Tracker</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Optimise PWM frequency so that the piezo pump works at its highest efficiency point. Each pump comes with a different optimum PWM frequency which can also have small variations over the pumps life cycle. As the pump calibration values are not known to the application, this optimum PWM working point is calculated by measuring the current drawn by the pump when activated and adjusting the PWM frequency in order to get near the highest possible value for that current in the next pump operation. This module adjusts the PWM frequency through the hardware numerical controlled \bullet  oscillator (NCO) module from a starting point of 20.9961 kHz (see Figure 8 and refer to "MuRata Specification of the Microblower reference [7]" documentation for further details).\par
The pump efficiency (hence drawn current) profile is a curve whereby, if the PWM frequency is either greater or lower than its optimum value, the current drawn by the pump decreases.\par
Figure 8, Piezo Pump: current Vs. PWM Frequency profile\par
The tracking algorithm measures the pump current and compares it with previous value to determine the sign of current variation. The required change of the PWM frequency for the next pump activation is determined from the previous frequency delta and the measured current variation using Table 12:\par
Previous PWM\par
Frequency step\par
Measured Current Variation\par
Next PWM\par
Frequency step\par
Positive\par
Positive\par
Positive\par
Positive\par
Negative\par
Negative\par
Negative\par
Positive\par
Negative\par
Negative\par
Negative\par
Positive\par
Table 12, Piezo Pump Frequency Tracking Algorithm\par
}
</Description>
      <Notes />
      <ContentValue>CbAX6pS6lo/RDJFTqFtDAQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00018</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- NRV Blockage Processing</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This processing allows for a blockage of the external valve to be detected. This works by reading the external pressure when the pump down is started. If the valve is blocked the external pressure will increase as the sensor is behind the vent. If this pressure increases by more than 30 mBar then a blockage has occurred.\par
This is also checked during the therapy maintenance and if the external pressure again increases by more than 30 mBar then a blockage has occurred. The threshold level for the failure is calculated by the initial pump down module and made available for the therapy maintenance module.\par
}
</Description>
      <Notes />
      <ContentValue>3mFDkBhBzqC1BxFIG3CxPQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00019</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- C5 Pressure Sensor</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Read pressure sensors to determine the current vacuum, decide if this is at target level depending on which state of the therapy delivery (IPD or MPD) the application is in.\par
Check if a gross leak condition has occurred during therapy maintenance.\par
Update the target vacuum value during therapy maintenance based on pump duty cycle.\par
This module consists of a number of sub-modules (e.g. Part 1..4) that abstract the interface with the State Machine from the lower level operations (e.g. I2C) to get and validate the pressure values form the external HW peripherals. This also allows unit testing of business logic independently of HW. (E.g. use of the leak detection output).\rdblquote\par
The highest level sub-module (Pressure_Part1.c) is used by the State Machine; the intermediate sub module uses the duty cycle module (DutyCycle.c) for some of its business logic, and the lowest level sub module (e.g. Pressure_Part4.c) interacts with the HW peripherals allocated to the pressure sensors (i2c.c).\par
The pressure sensor module adopts a number of mechanisms to guarantee valid vacuum readings are produced:\par
Both internal and external pressure readings must be successful otherwise an error is returned\par
Each pressure read operation is repeated a number of times in case of unsuccessful acquisition, before returning an error\par
Internal Temperate Senor\par
This module also reads the temperature from the internal pressure sensor. The value read is a 16 bit 2\rquote compliment number and is logged in the EEPROM by the Performance logger Manager. In order to calculate the actual temperature in \'b0C the following formulae is used (42.5 - (value/480)).\par
(See reference [6] for further details\par
https://www.st.com/content/ccc/resource/technical/document/technical_note/23/dd/08/f8/ac/cf/47/83/DM00242307.pdf/files/DM00242307.pdf/jcr:content/translations/en.DM00242307.pdf for further details)\par
}
</Description>
      <Notes />
      <ContentValue>RUIagUyM9fjvuoatIvhyjA</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00020</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- C6 Push Button</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Detect button presses for short maximum of (2s) or long (&gt;2 s) interactions. The module therefore implements a debounce mechanism to mitigate noise on the GPIO pin allocated to the button switch peripheral.\par
An overall policy is enforced, whereby (apart from some exceptions) a button press event is discarded if it lasts across two states (i.e. from-state and to-state) of the State machine. In this case, the user will have to release the button and press it again for the event to be actioned into the new state (i.e. to-state). The only exception to this policy is when button presses are originated into Fault state, the duration will be tracked in IPD and MPD states (see reference [2]).\par
This module is used by the State Machine and uses the MCC module to interact with the corresponding hardware peripheral.\par
}
</Description>
      <Notes />
      <ContentValue>E2UVZEtqaaX2/jtrP5AIKg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00021</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>- C7 Software Timer</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Provide the hook into the system timer so that the application runs every 100ms.\par
Provide also a number of countdown timers that the application uses as internal timers without having to access every time the memory shared between the system timer interrupt and the application. As part of the routine that generates the 100ms tick, the statuses of countdown counters in use are updated providing the same time resolution of the system tick (i.e. 100ms).\par
Provide a Time Delay function that produces an execution delay (in milliseconds) by forcing the program counter in a loop until the delay has expired. In order to maintain the delay accuracy within a reasonable range (e.g. 10%) the System Clock must be set to 4MHz.\par
}
</Description>
      <Notes />
      <ContentValue>k3JKbOydlBcpx/fceoi5TQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00022</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>C8 Performance Logger</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This Device encapsulates the functionality required to capture performance statistics and store them in external EEPROM.\par
This module\rquote s API\rquote s are used by a number of \lquote Managers\rquote  to store the most up-to-date device records in EEPROM using the \lquote Logging Manager\rquote  to perform the actual write to EEPROM memory.\par
The performance logger logs records once every minute and will returns as error after the records for a full 7 days have been logged. (7*24*60 = 10080 records). This event in turn will cause the system to enter the NRE state.\par
}
</Description>
      <Notes />
      <ContentValue>Bzdk2B7OdUnjOHj2ZWxgOQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00023</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|DEVICES</Address>
      <Title>C12 Transmit Serial Port</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Transmit data over the serial port (EUSART). The application is able to send data out of the device (TX), but cannot read data in the opposite direction (RX) because there is no available GPIO pin dedicated to this functionality (HW limitation).\par
This module is used by the POST state in the State Machine, and it uses the EUSART module to use the HW communication peripheral. See section 3.7.10.\par
}
</Description>
      <Notes />
      <ContentValue>6L2tDHygyi6kMKcGrOZOQg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00024</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION CUSTOM FILES</Address>
      <Title>- D3 Hardware Interface</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module provides an abstraction layer between the device modules and the HW auto-generated modules. This is done mainly for SW testing purposes where the interface for the real HW is not relevant; can be simulated and mustn't introduce platform specific dependencies in the higher SW layers.\par
The main functionality is:\par
Enablethe MCU internal interrupt\par
Enablethe external peripheral interrupts\par
Initialise all the HW interfaces as configured in the MCC module\par
}
</Description>
      <Notes />
      <ContentValue>WlkOK2HQWLvWk7qgH1z4LA</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00025</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION CUSTOM FILES</Address>
      <Title>- D4 I2C EEPROM</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module reads and writes data to the EEPROM chip connected to the PIC16LF1509 microprocessor via an I2C bus and it is used by the Performance Logger and POST state modules.\par
The module's write function writes the desired value to the specified address making sure the value is not stored across 2 consecutive pages (the EEPROM is organised in 256 byte pages).\par
}
</Description>
      <Notes />
      <ContentValue>Uc3Au3OXc1eRWwBqbs9igg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00026</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION CUSTOM FILES</Address>
      <Title>- D1 Watchdog</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Watchdog module implements the independent watchdog (WDG) peripheral. This is used to resolve processor malfunctions due to hardware or software failures. When the watchdog is initialised, it maintains an internal counter which requires refreshing roughly every 512 milliseconds by calling the Watchdog_Clear function. Failure to refresh the watchdog will cause the MCU to reset. MCU fuses are set such that the. WDG is disabled in Deep Sleep mode so the device does not continually reset.\par
}
</Description>
      <Notes />
      <ContentValue>HLv6GvDHN7m3mFGWpxon2w</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00027</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION CUSTOM FILES</Address>
      <Title>- D2 Power Control</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module provides different functions to initialise and access the hardware:\par
Provide a global access point to enable and disable peripherals (for example enabling the Main Circuit Power, startthe PWM module used to activate the pump).\par
Put the device in Deep Sleep mode\par
}
</Description>
      <Notes />
      <ContentValue>Bf9AKy7qyndrfUhKY5c5VA</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00028</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D9 Pin Manager</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module configures the PIC16LF1509 GPIO peripherals (as selected in the MPLAB Code Generator GUI) and provides low level read and write functions to GPIO registers.\par
}
</Description>
      <Notes />
      <ContentValue>xBt8hQqQ+NutKNN7O5+Eaw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00029</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D7 ADC</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The ADC module implements the ADC input capture for all ADC channels. When a round of ADC acquisition is kicked off by a higher level module, the ADC is configured to the first channel to quantise the analogue input. When the ADC conversion is completed, an ADC End-Of-Capture interrupt is triggered by the ADC peripheral. Each ADC channel has a circular buffer to which its quantised values are written. Once the buffer is full, the average of all the values in the buffer is provided when other modules request a reading for that channel. This provides some filtering to protect against erroneous readings.\par
Channel\par
ADC channel(ADC1_INx)\par
Battery Voltage (FVR)\par
0x1E\par
Pump Current (HBridge current)\par
0x04\par
Boost Convert Voltage\par
0x06\par
Table 13, ADC Channel Usage\par
}
</Description>
      <Notes />
      <ContentValue>WFKloGn6zZbAzjC1na/j+A</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00030</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D8 DAC</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module provides the interface to set the value of Boost Reference Voltage via the DAC driver (as selected in the MPLAB Code Generator GUI).\par
}
</Description>
      <Notes />
      <ContentValue>5a3n3GSPCvivCT2rXLts/A</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00031</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D10 FVR</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module initialises the FVR driver (as selected in the MPLAB Code Generator GUI).\par
}
</Description>
      <Notes />
      <ContentValue>n7jIOBbguDZVkcWER3kL4A</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00032</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D6 MCC</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module provides APIs (e.g. SYSTEM_Initialize) to initialise for all HW modules selected in the GUI including the main oscillator.\par
}
</Description>
      <Notes />
      <ContentValue>WLMOXtoELnolaHStXwgwzQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00033</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D11 NCO 1</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module initialises the Numerically Controlled Oscillator (NCO). This is a timer that uses the overflow from the addition of an increment value to divide the input frequency, providing a better accuracy.\par
}
</Description>
      <Notes />
      <ContentValue>ZMCpXR9YfS+gW3RLP36sxw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00034</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D12 Timer 1</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module provides the API to configure and interrogate the main software timer used to periodically run the application (for the 100ms interval).\par
}
</Description>
      <Notes />
      <ContentValue>qpMcn7jJ2sooPDs9wjsQSQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00035</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D13 Interrupt Manager</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module provides implementations for global interrupt handling. Each configured interrupt has to be associated to a handler (ISR). The following handlers are called within the same interrupt manager routine:\par
Handler\par
ADC channel (ADCI Inx)\par
TMRI_ISR\par
ISR associated to Timer 1 tick and that invokes the main Application and updates the software timer counters\par
I2C_ ISR\par
ISR for I2C operations\par
I2C_ BusCollisionISR\par
N/A\par
PIN_ MANAGER_ IOC\par
Clear IOC bits and global interrupt-on-change\par
Table 14, System Interrupts\par
}
</Description>
      <Notes />
      <ContentValue>zov4mUHFTGd6pSCxLmBgzQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00036</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D14 I2C</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The I2C module operates as an I2C master using the MCU's I2C hardware peripheral. It is used to communicate with other I2C devices (in this case, the external pressure sensors) acting as I2C slaves.\par
}
</Description>
      <Notes />
      <ContentValue>3c/NhnDThERNJuFX0jvgeQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesSpec-00037</Id>
      <Address>|Design|SODSN002 Eton Firmware Software Design Specification|UNIT DESCRIPTION|HARDWARE ABSTRACTION- AUTO GENERATED FILES</Address>
      <Title>D5 EUSART</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This module encapsulates the functionality to send commands and text strings via the UART. The UART is initialised to 19200 BPS with 8 stop bits, no parity and 1 stop bit.\par
This is used by the Transmit module that implements the data transmission from the MCU to the ICT equipment.\par
Given the configuration of the available pins on the MCU the communication in only in TX (i.e. no data from ICT equipment to the MCU).\par
}
</Description>
      <Notes />
      <ContentValue>6NILUuLH5ggBFZiOrelYcg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00001</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>POST</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The Power On Self Tests are run by the test via the UART when the ICT equipment starts the system.\par
}
</Description>
      <Notes />
      <ContentValue>6l8HRwB133DQM4RvY4S/sg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00002</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>Idle State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The idle state has two power sub-states to allow it to be managed in its storage and operational modes.\par
}
</Description>
      <Notes />
      <ContentValue>ck1h2IuqbhsV1aLlZGH6ug</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00003</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>Idle State Deep Sleep</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This state is entered when the system first powers up. On entry to this state the system powers off all the devices and puts the processor in a deep sleep mode so that it can only be woken by a hardware interrupt caused by a button press. This uses the minimum amount of power and is the state the device e in when in storage before use.\par
Event\par
Description\par
Short button press\par
Starts the pump down sequence.\par
If the pull tab has been removed the pump can be started. Once this has occurred the system will enter the operational state as described in the next section.\par
If the pull tab has not been removed an out of range voltage error occurs and the system will return to the deep sleep mode.\par
Once this state has been exited, the system will never enter it again. The processor may go to sleep in other states but only for the100ms tick duration.\par
}
</Description>
      <Notes />
      <ContentValue>yXg425Vuen78GXXJUgZVOA</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00004</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>Idle State Operational</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 In this state there will always be a system timer active which will provide a 100ms tick.\par
Event\par
Description\par
Short button press or one hour elapses\par
Call the LED control module to start the pump down sequence\par
Enter the PUMP DOWN state\par
\{Dsn_DesArch-00005\} Pump Down State\par
This state is entered from:\par
IDLE state, by means of short button press or 60 minute auto-restart.\par
FAULT state, by mean of short button press or 60 minute auto-restart.\par
It will start the pump down LED sequence provided by the LED Control Module.\par
Event\par
Description\par
100ms schedule\par
delay\par
On each schedule the pump down alternates between reading the pressure and pumping.\par
Long button press\par
Switch LEDs off\par
Enter POWER DOWN state\par
Time out after 20s\par
Pressure has not been achieved in last 5 seconds of the pump down\par
Enter Fault state\par
Time out after 20s\par
Pressure has been achieved in the last 5 seconds of the pump down.\par
Enter MONITOR state.\par
Note: It will be up to the monitor state to display success.\par
Voltage out of range\par
Enter the IDLE state\par
Power Tracker Frequency Fail\par
Enter the FAULT state\par
Enter NRE\par
Battery Life End\par
Enter NRV\par
NRV\par
}
</Description>
      <Notes />
      <ContentValue>CGobhINauyTC/gqtq/IVOA</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00006</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>Monitor State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This state run in cycles of 10 100ms ticks i.e. 1 second. In one of the ticks it reads the pressure and if the pressure indicate pumping is required then it will pump during the next tick, During the other 8 ticks as no functionality is required the system will go into sleep mode in order to make power savings.\par
Event\par
Description\par
Time out\par
Monitor the pressure every 1 second.\par
Read the pressure, if it\rquote s too low then switch the pump on for 100ms.\par
Pressure Fail\par
If the duty cycle of the pump on/off indicates that there is a leak.Enter FAULT state\par
Voltage out of range\par
Or\par
Power Tracker Frequency Fail\par
Enter FAULT state\par
Long button press\par
Switch LEDs off\par
Enter POWER DOWN state\par
Short Press or\par
Pump Down LED sequence completed\par
Display Success status\par
Enter NRE\par
Battery Life End\par
EOL\par
End of 7 days therapy.\par
NRV\par
NRV Blockage\par
Power Saving\par
Battery maintenance\par
}
</Description>
      <Notes />
      <ContentValue>Ha1PwYTzrhb3Xp3CWUiAfg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00007</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>Fault State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 The fault state will display the Amber for 2 seconds which indicates a fail. It will then flash the Amber for 60mins.\par
Event\par
Description\par
Time out of 2s\par
Start flash of Amber for 60s\par
Amber LED is ON for 0.2 OFF for 1.8s\par
Time out of 60mins\par
Enter PUMP DOWN state\par
Short Button Press\par
Enter PUMP DOWN state\par
Note: If the key is held long enough for a long press, then the system will go to the PUMP DOWN state and then automatically to the POWER DOWN state.\par
}
</Description>
      <Notes />
      <ContentValue>ZR+ULbyHThO6Glg5HeInaw</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00008</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>Power Down State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This state causes a delay of 3 seconds and then goes to the idle state.\par
}
</Description>
      <Notes />
      <ContentValue>XTm5U3cwHARLZ4iW9fxRIQ</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00009</Id>
      <Address>|Design|SODSN001 Eton Firmware - Software Architecture Document|Device Overview|A.1 Application Layer</Address>
      <Title>NRE Non Recoverable Error</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This is the state that is entered when the end of life has been detected. The end of life may be caused by due to the End of Battery Life or due to the 7 day therapy timer. It simply loops and does nothing.\par
}
</Description>
      <Notes />
      <ContentValue>HnEqLF/+5vKUrVCILg5Mgg</ContentValue>
      <ModifiedVersion>B_03</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>NotReady</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>00013</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</Address>
      <Title>Detailed Timing Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}{\f1\fnil\fcharset2 Wingdings;}}
\viewkind4\uc1\pard\f0\fs17 This test will perform detailed timings of the various LED sequences to verify they are within acceptable tolerances.\par
3.3.1.1\tab Test Sequence\par
IDLE \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Activate\rquote ) \f1\'e0\f0  PUMP DOWN\par
State change matrix: 1.\par
3.3.1.2\tab Prerequisites\par
\bullet\tab This test must be performed with the Eton Firmware PCBA marked with label \ldblquote S1725-2\rdblquote . The Eton Firmware PCBA should be setup using the procedure in Appendix D - Timing Test.\par
\bullet\tab\lquote Power level is good\rquote .\par
\bullet\tab\lquote Dressing Connected\rquote .\par
\bullet\tab The Eton Firmware PCBA is in the IDLE state.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>00014</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</Address>
      <Title>Power Consumption Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Power Consumption Tests\par
This test will verify the current consumption in a number of different states as described in section 3.4.1.1.\par
In addition, the test also verifies the UIRS 01040 and UIRS 03050 requirements.\par
3.4.1.1\tab Test Sequence\par
1.\tab Test Case 1: When the system is powered up but the tab has not been pulled.\par
\par
Measurement State: IDLE.\par
\par
2.\tab Test Case 2: When the system is powered up but the tab has not been pulled and after the button has been pressed.\par
\par
Measurement State: IDLE.\par
\par
3.\tab Test Case 3: Power consumption when the tab has been pulled but before the button is pressed.\par
\par
Measurement State: IDLE.\par
\par
4.\tab Test Case 4: Power consumption when the tab is pulled and monitor state entered and paused.\par
\par
Measurement State: IDLE.\par
\par
5.\tab Test Case 5: Power consumption over a period of time when in the MONITOR state. This test will involve using a digital storage scope to capture current pulses when the pump is on and estimating the current consumed for those pulses over a period of time. (I.e. using the measured current, pulse width and number of pulses to provide an estimate for the overall current consumption).\par
\par
Measurement State: MONITOR\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>00015</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</Address>
      <Title>NRE Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}{\f1\fnil\fcharset2 Wingdings;}}
\viewkind4\uc1\pard\f0\fs17 This test will verify the Non-Recoverable Error State and the Eton Firmware PCBA\rquote s handling of hardware errors.\par
3.5.1.1\tab Test Sequence\par
\par
1.\tab MONITOR \f1\'e0\f0  NRE State change. Test Steps #1 to #9.\par
MONITOR \f1\'e0\f0  NRE Battery Life End (EOL) \f1\'e0\f0  Short Button Press, NRE continues \f1\'e0\f0  Short Button Press, NRE continues \f1\'e0\f0  Long Button Press, NRE continues \f1\'e0\f0  Long leak present, NRE continues \f1\'e0\f0  Long leak repaired, NRE continues \f1\'e0\f0  Long leak present, Fault Time-out 60 minutes, NRE continues \f1\'e0\f0  Long leak repaired, NRE continues \f1\'e0\f0  Eton Firmware PCBA Power down, test end.\par
\par
State change matrix: 13 \f1\'e0\f0  19.\par
2.\tab PUMP DOWN \f1\'e0\f0  NRE State change. Test Steps #11 to #20.\par
IDLE \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Activate\rquote ) \f1\'e0\f0  PUMP DOWN \f1\'e0\f0  NRE Battery Life End (EOL) \f1\'e0\f0  Short Button Press, NRE continues \f1\'e0\f0  Short Button Press, NRE continues \f1\'e0\f0  Long Button Press, NRE continues \f1\'e0\f0  Long leak present, NRE continues \f1\'e0\f0  Long leak repaired, NRE continues \f1\'e0\f0  Long leak present, Fault Time-out 60 minutes, NRE continues \f1\'e0\f0  Long leak repaired, NRE continues \f1\'e0\f0  Eton Firmware PCBA Power down, test end.\par
\par
State change matrix: 1 \f1\'e0\f0  9 \f1\'e0\f0  19.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>00016</Id>
      <Address>|Test|SOTST001 Eton Firmware - Manual Tests - Additional|Testing User and Pump Interface|Test Cases-Hardware</Address>
      <Title>NRV Tests</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}{\f1\fnil\fcharset2 Wingdings;}}
\viewkind4\uc1\pard\f0\fs17 This test will verify the Non-Return Valve (NRV) Blockage condition and the Eton Firmware PCBA\rquote s handling of NRV errors.\par
3.6.1.1\tab Test Sequence\par
\tab\par
1.\tab PUMP DOWN \f1\'e0\f0  FAULT (NRV Block) State change. Test Steps #1 to #10.\par
IDLE \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Activate\rquote ) \f1\'e0\f0  PUMP DOWN \f1\'e0\f0  Exhaust Hole blocked, STATUS (\lquote Indicate Fail\rquote ) \f1\'e0\f0  FAULT (NRV Block) \f1\'e0\f0  STATUS (\lquote Indicate Fault\rquote ) \f1\'e0\f0  Exhaust Hole cleared, FAULT continues \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Activate\rquote ) \f1\'e0\f0  PUMP DOWN \f1\'e0\f0  Pressure Achieved, STATUS (\lquote Indicate Success\rquote ) \f1\'e0\f0  MONITOR \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Status\rquote )\par
\par
State change matrix: 1 \f1\'e0\f0  6 \f1\'e0\f0  15 \f1\'e0\f0  8.\par
2.\tab MONITOR \f1\'e0\f0  FAULT (NRV Block) State change. Test Steps #11 to #17.\par
MONITOR \f1\'e0\f0  Exhaust Hole blocked, STATUS (\lquote Indicate Fail\rquote ) \f1\'e0\f0  FAULT (NRV Block) \f1\'e0\f0  STATUS (\lquote Indicate Fault\rquote ) \f1\'e0\f0  Exhaust Hole cleared, FAULT continues \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Activate\rquote ) \f1\'e0\f0  PUMP DOWN \f1\'e0\f0  Pressure Achieved, STATUS (\lquote Indicate Success\rquote ) \f1\'e0\f0  MONITOR \f1\'e0\f0  Short Button Press \f1\'e0\f0  STATUS (\lquote Indicate Status\rquote )\par
\par
State change matrix: 12 \f1\'e0\f0  15 \f1\'e0\f0  8.\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Design</EntityType>
      <Id>Dsn_DesArch-00005</Id>
      <Address>|Design|SODSN001 - PumpDown|Pump Down State</Address>
      <Title>Pump Down State</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This state is entered from:\par
\bullet\tab IDLE state, by means of short button press or 60 minute auto-restart.\par
\bullet\tab FAULT state, by mean of short button press or 60 minute auto-restart. \par
It will start the pump down LED sequence provided by the LED Control Module.  \par
Event\tab Description\par
100ms schedule \par
delay\tab On each schedule the pump down alternates between reading the pressure and pumping.\par
Long button press \tab Switch LEDs off\par
Enter POWER DOWN state\par
Time out after 20s\tab Pressure has not been achieved in last 5 seconds of the pump down \par
Enter Fault state\par
Time out after 20s\tab Pressure has been achieved in the last 5 seconds of the pump down.\par
Enter MONITOR state.\par
Note: It will be up to the monitor state to display success. \par
Voltage out of range\tab Enter the IDLE state\par
Power Tracker Frequency Fail\tab Enter the FAULT state\par
Enter NRE\tab Battery Life End\par
Enter NRV\tab NRV\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings>
        <EntityMapping xsi:type="EntityTestMapping">
          <Notes>Pump Down State</Notes>
          <LinkedEntityType>Test</LinkedEntityType>
          <Category>Functional</Category>
          <TestId />
          <TestPlugin />
          <Environment />
        </EntityMapping>
      </EntityMappings>
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00001</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-1</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>mG093WxZ1acV+A+m7eKk2g</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00002</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-2</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>G6YHCXGLyB/HqLePg4r82g</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00005</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-5</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>0Ll/8dXGJzaW7Kiw/gyvgw</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00006</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-6</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>0JNDp/40TqdUb5rxWHDPOw</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00007</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-7</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>UGI/mzWeiZLUnejbiuhZ2w</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00008</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-8</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>1xsBiugduyUht9uYkqbRBg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00015</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-15</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>w08LlTn7CKky0gbYXI9NWA</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00016</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-16</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>3Xa7QIJfq69v+rD/LEQFRQ</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00018</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-18</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>zNmDP0WleJ87GrTsHd87cg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00022</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-22</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>SZcwR+4RH/aQEsaM6qi8Kg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00024</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-24</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>WQPFf1ijJy12y/2fXIe+kg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00031</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-31</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>nFfZ1vplpPycOSJ0VUzbjg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00033</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-33</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>JpHM7iCddo8hUgp79g+pWg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00034</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-34</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>+wgeIJ7vx+jtXVvOlRqLWg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00035</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-35</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>MXr91+OvO/9PsM8R7CN2Jg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00036</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-36</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>xXrKbnPxOpwufuxtfVy1cQ</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00037</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-37</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>UbvTxkCQ9I/7zJXo8Xt7IQ</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00039</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-39</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>edj6n+4u9Gq1YDmO5Q/LLQ</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00041</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-41</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>xhMxBH66XsDGe/MjK4RE0Q</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00043</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-43</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>diI7tQvyt9mG3tpE0cKkfQ</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00044</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-44</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>A6nKt7IkzK/sYbqh+k9C/w</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00050</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-50</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>2hbaHlOdWrjGDFe6WB6W0A</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00051</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-51</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>YGedMn9HMZaIsSM7Ys4/qA</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00052</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-52</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>CD2RYhTogAOjipRHvS/xxw</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00053</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-53</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>LmXoVdHOgpQCnbfsIRqX+w</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00055</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-55</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>hYZd4zqM6pO+xo+TfuE0tw</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00058</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-58</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>3VrPNPDLBNfidZWg5sJfqA</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00059</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-59</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>TYf7B92uE9qA55AmD34Xzw</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00060</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-60</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>lyxzQG3WCxGpseHWO+fIAQ</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00061</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-61</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>DjzxuQhOM4S50K0th48WCg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00065</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-65</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>NgGe99w7xv16xUZ4eci3zA</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00067</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-67</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>Wj2l+Jys3PbgqC9M3uwxFA</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00068</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-68</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>2R1hsnfCIxJtvzCJHrGSIg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00069</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-69</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>OFD6iHRtewReK9P50PnEQA</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00082</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-82</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>qkN7Dppz2BX5ppL1LbJ1+w</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>ESUTS-00083</Id>
      <Address>|Test|SOTST002 Eton Firmware - Unit Test Specification|List of Unit Tests|Tagging for Trace Matrix</Address>
      <Title>- HET-83</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 no text specified\par
}
</Description>
      <Notes />
      <ContentValue>Zo3p8HTjISDkvCYdJtzUrg</ContentValue>
      <ModifiedVersion>B_02</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00002</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>Generic Log Buffer Verification</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This is a generic test for verifying a log buffer uploaded from the Eton device. The fields can be verified by converting them into the standard CSV file or by using the log buffer analyse tool logAnalyse.py. See the logAnalyse section on how to extract the individual fields. The values checked here also verify the functionality of the underlying drivers. If any of the range checks fail then they should be justified for the individual test.\par
Test Execution\par
Use the extractData.bat script to extract relevant fields\par
Usage:  extractData.bat  \ldblquote logfile\rdblquote\par
\par
Test Step\par
Action\par
Expected Result\par
Verify the voltages are in the range as expected.\par
Pass if voltage are as expected\par
Verify the voltage range is from 1.8 to 3.2 volts\par
Verify the external pressure is as expected\par
Normal atmospheric pressure is 1013 mBar.\par
The normal range which has been read is 1090 - 1024 mBar\par
Pass if pressure is as expected\par
Verify the differential pressure is in range when in therapy is in range\par
In the therapy state this should be equal to or above 92 mbar\par
Verify initial pump down times\par
This will range from 0 to 20 seconds.\par
Pass if pump down times as expected\par
Verify the duty cycle.\par
This is units of 1/30th expressed as a percentage.\par
In the monitor state it cannot be greater than 50% as this will be deemed a leak.\par
Verify the duty cycle does not exceed 50%\par
Verify the duty cycle is consistent thought out the therapy state.\par
Verify the last records are empty.\par
Only the first 10080 record should be used, the rest should be empty\par
Empty as expected.\par
}
</Description>
      <Notes />
      <ContentValue>0itg44ASlviMF6ZkgmbUsQ</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00003</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>Timing and Power Saving Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This tests the timing of the managers within the system do not use more than their allocated time in any one schedule (i.e. 100ms) and also that the processor goes to sleep in unused ticks during therapy. The test monitors that amount of free time available after the processing of one tick and the start of the next tick. This is achieved by simply keeping a loop count in the application of the number of times the tick flag is checked before it becomes active from the low level interrupt. The results are output via the UART port.\par
To test the power saving function is active a count is used to switched on and off the call to the routine which sleeps to the next tick when the system is in therapy mode. When the power saving is active, the processor will sleep until the next tick occurs and when it is not active there will be a large count as the processor waits\par
The following SCUs are used\par
SCU is added to modify the application code and display the results.\par
The Log Buffer has been cleared see section 3.9 for details on how to do this.\par
Pre-requisites\par
The Eton PCBA is in the idle state.\par
The battery level is good. (Note the value for the verification process)\par
The dressing is in the Dressing connected state.\par
The device is connected to a PC as defined in section 7. A suitable filename is setup to record the data.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Program the Eton device with the  \ldblquote timertest1\rdblquote\par
Ensure tera term is setup to view and log data.\par
Data being view and logged\par
Verify \ldblquote Free count 00000\rdblquote  is being output on tera term which is the data output before any key is pressed\par
Data being observed\par
Disconnect and reconnect dressing\par
Dressing connected\par
Note the time duration of the following events for review in the log at a later stage\par
Perform a short press on input button to start pump down\par
Verify the pump down starts correctly.\par
Allow to  run for at least  1/2 hour\par
Disconnect the dressing for 5 minutes\par
Dressing disconnected\par
Reconnect the dressing and start pump down\par
Dressing reconnected and therapy active\par
Perform several status by short presses\par
Green LED comes on for 2 seconds each time\par
Wait for 4 minutes\par
Switch system off and leave off for 6 minutes\par
Start therapy again for 10 minutes\par
Cause an NRV blockage which should result in the alert message.\par
Start the system again after 3 minutes\par
Upload the log buffer and give a suitable name.\par
Log in the test log.\par
Buffer uploaded\par
Verify the log buffer as per the \ldblquote Generic Log Buffer Verification\rdblquote  test and by the noted times from above\par
Pass if buffer verifies\par
Verify the tera term log\par
Verify that the word \ldblquote Fail\rdblquote  does not appear in the tera term log which would indicate there was less than expected time between schedules.\par
Pass if the word \ldblquote Fail\rdblquote  does not appear\par
Verify that when that when in therapy mode and power saving is active you get a series of 8 \ldblquote Free count\rdblquote  in the data. Execute the command as follows.as per the following section\par
Verify the Tera Term Log\par
cat \ldblquote  tera term log \rdblquote   | uniq -c | grep 0000 | uniq -c\par
Verify multiple of the following where nnnn is the number of occurances\par
nnnn Free count 00000\par
Note: There may be one at the end where the program is terminated during a power saving sequence.\par
}
</Description>
      <Notes />
      <ContentValue>H2mLDLopXOH8QPaoqoEENg</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00004</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>Stress Test Pump Down</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This produces various repeated pump down and pause sequences. This verifies the operation of the application as well as the underlying drivers. The following SCUs should be present.\par
SCU which changes the EOL to be 15590 records\par
Update the Log buffer every second\par
The following shows the action table used\par
// Stress test with repeated pump downs\par
struct test_entry test_array[2]  = \{\par
\{  ACTION_BUTTON_E,3,BASE_DELAY\},        // Start a Pump down\par
\{  ACTION_BUTTON_E,21,BASE_DELAY\},\par
\};\par
Pre-requisites\par
The Eton PCBA is in the idle state.\par
The battery level is good. (Note the value for the verification process)\par
The dressing is in the Connected state to the large reservoir dressing.\par
The Log Buffer has been cleared\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Program the Eton device with the  \ldblquote pumpdowntest1\rdblquote\par
Perform a short press on input button.\par
Verify the test starts correctly by starting a normal pump down sequence.\par
Allow the test to run for at least 5 hours.\par
A pump down LED sequence followed by a pause LED sequence can be observed every few minutes.\par
Verify the device is in the NRE state caused by the EOL condition.\par
No LEDs will be on. (watch for 2 minutes)\par
There will be no response when the button is pressed\par
When disconnected from the dressing no pumping will take place.\par
Upload the log buffer and give a suitable name.\par
Log in the test log.\par
Buffer uploaded\par
Verify the log buffer as per the \ldblquote Generic Log Buffer Verification\rdblquote  test\par
Pass if buffer verifies\par
Verify the sequences are as expected by comparing it to the pumpdown_test1_ref.txt. An example of the format is shown in the next section.\par
The script VerifyState can be used for this.\par
Test passes\par
}
</Description>
      <Notes />
      <ContentValue>8n5npHaBBwXp5OJODIE1Ig</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00005</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>System Assert Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test runs the test harness and then causes a hang via a SCU when the pump is active. The system should reset. The following SCUs are added to the system:-\par
Cause an infinite loop when pumping is active.\par
Verify the Assert kicks in and causes the system to reset..\par
Pre-requisites\par
The Eton PCBA is in the idle state.\par
The battery level is good. (Note the value for the verification process)\par
The dressing is in the connected state to the large reservoir dressing.\par
The Log Buffer has been cleared\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Program the Eton device with the  \ldblquote asserttest1\rdblquote\par
Perform a short press on input button.\par
Verify the test starts correctly by starting a normal pump down sequence.\par
When the pump down has completed and the status is being displayed.\par
Disconnected the dressing\par
Verify the pumping stops and all the LEDs go off.\par
The device should have reset.\par
The device should have now reset and be ready to start again. Repeats steps 1 to 3 to verify this.\par
The test passes if the steps are successfully repeated..\par
}
</Description>
      <Notes />
      <ContentValue>yktDBfK4ZjCyUBpoawI1Rg</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00006</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>Frequency Tracking Testing</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This tests records the frequency tracking data and ensures that the values are as expected. The data from this test will provide data for further system optimisation.\par
The following SCUs are added to the system:-\par
Automatically run the SCU on power up. This will print data about the frequency tracking when the system is running.\par
Pre-requisites\par
The Eton PCBA is in the idle state.\par
The battery level is good.\par
The dressing is in the Dressing Connected state to the large reservoir.\par
The device is connected to Tera Term and a log file setup (tracktest1_log) as specified in reference [7].\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Program the Eton device with the  \ldblquote trackertest1\rdblquote\par
Start the pump down\par
Pump down should complete.\par
Verify data is beign sent t the tera term and logged to the log file\par
Data being logged.\par
Upload the log buffer as per the instructions.\par
Log buffer uploaded\par
Leave for 1 hour.\par
Data should continue to be logged\par
Verify the logged data\par
Search for the  \ldblquote 5min\rdblquote  marker in the file as shown in the next section\par
Ignore the first record\par
Verify the following for all records\par
Verify the \ldblquote ave curr\rdblquote  is  145 to 155\par
The pumpcount is between 25 and 35\par
The frequency is in the range 2780 to 2840\par
The maximum frequency difference is no more 20.\par
Pass if fields verify ok\par
Frequency Tracker Log Record\par
5min stats 3059 pumpcount 30 curr tot 4578  ave curr 152 minF 2808 maxF 2816 diff 8\par
}
</Description>
      <Notes />
      <ContentValue>AmLpkNU1WjG0hM2BAfKcpg</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00007</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>POST Testing</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This tests the POST test. This is a simulation of the test by connecting the device to the UART I2C connecter.\par
The following SCUs are added to the system:-\par
Automatically run the SCU on power up\par
Output the test results as text in the following format \ldblquote D-nnnnn\rdblquote  where \lquote D\rquote  is the number of the test and \lquote nnnnn\rquote ; is the result of the test.\par
Pre-requisites\par
The Eton PCBA is in the idle state.\par
The battery level is good. (Note the value for the verification process)\par
The dressing is in the Dressing connected state.\par
The device is connected to a PC as defined in section 7. A suitable filename is setup to record the data.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Program the Eton device with the  \ldblquote posttest1\rdblquote\par
The program will automatically start to run and output the results on the Tera Term display.\par
The green LED and amber LED will flash on and off sequentially.\par
Verify the data is logged to the selected file\par
Leave the program running until enough results are collected (at least 20 cycles).\par
Verify results are collected by viewing the log file which has been setup.\par
Reload the device with a working application to stop the test\par
Test stopped.\par
Verify the result as per the following section\par
Test passes if results are as expected. See section below.\par
Results Format\par
The following is the format of the result\par
1-nnnnn  Gives the value of the voltage reference  VBOOST_REF_27V\par
4-nnnnn External pressure sensor value\par
5-nnnnn Internal pressure sensor value\par
7-nnnnn H-Bridge current (PWM-1)\par
6-nnnnn Write EEPROM                        Current result 771 or 0x303\par
8-nnnnn H-Bridge current (PWM-2)\par
9-nnnnn IO_RA5\par
Result\par
Expected Result\par
1 VBOOST_REF_27V\par
~49164\par
4 External pressure\par
~64771\par
5 Internal pressure\par
~64000\par
6 Write EEPROM\par
Current result 771 or 0x303\par
8 H-Bridge current (PWM-1)\par
~16385\par
9 IO_RA5\par
00000\par
Table 4 POST Results Table\par
}
</Description>
      <Notes />
      <ContentValue>TDkVqHh7a4sysuWPMif0uw</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00008</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>Clear Log Buffer and Watch Dog Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test verifies that the Log Buffer can be cleared correctly to its default state. It tests the write function to the EEPROM and also that that watchdog will reset processor if it is not kicked.\par
Note: This test is run as parts of the other tests to bring the log buffer into a known state. This is necessary to ensure that variables are always 0xFF as the application assumes this when writing to the device as the SLEEP mode is achieved by simply incrementing the EEPROM address count. Also it is not possible to know where any previous test stopped writing to the buffer.\par
Test Execution\par
Test Step\par
Action\par
Expected Result\par
Program the Eton device with the  \ldblquote scrubEeprom\rdblquote\par
Perform a short press on input button.\par
The green LED will come on and stay on while the Log Buffer is being set to 0xFF.\par
Wait for appropriately 5 minutes when the green LED will go off.\par
(This is all that is necessary to erase the log buffer)\par
Green LED goes off and specified delay\par
The program enters an endless loop without kicking the watchdog which causes the processor to reset.\par
This in turn switches the green LED off.\par
The processor will reset\par
On the first execution of this test repeat test step 1-4 to verify the processor is in the reset state.\par
Step 1-4 are repeated correctly.\par
On the first execution of this test upload the log buffer and verify all the fields empty.\par
Use logAnalyse.py -f clear.txt &gt; clear.csv\par
Verify all fields are empty.\par
}
</Description>
      <Notes />
      <ContentValue>pTTrV8NV85BsT6giUqM/Sg</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00009</Id>
      <Address>|Test|SOTST003 Eton Firmware Automated Test Specification|Automated Tests</Address>
      <Title>GPIO Test</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 This test displays the values of the IO Pins in the passive modes of the system to ensure that they are correct for operational and energy saving.\par
}
</Description>
      <Notes />
      <ContentValue>HOptVxyFM4/pBNjyGSj+Vw</ContentValue>
      <ModifiedVersion>A_01</ModifiedVersion>
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
    <TraceableEntity>
      <EntityType>Test</EntityType>
      <Id>EFATS-00001</Id>
      <Address>|Test|SOTST003 Eton Firware Automated Tests|Automated Tests</Address>
      <Title>State Transition</Title>
      <Description>{\rtf1\ansi\ansicpg1252\deff0\deflang2057{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs17 Tests following state transitions:\par
1.\tab\tab IDLE\tab PUMP_DOWN\tab Key Press\par
2.\tab\tab IDLE\tab PUMP_DOWN\tab 1 Hour Time-out\par
3.\tab\tab PUMP DOWN\tab IDLE\tab Voltage out of range\par
4.\tab\tab PUMP DOWN\tab SHUT DOWN\tab Long Button Press\par
5.\tab\tab PUMP DOWN\tab FAULT\tab Failed to reach pressure\par
6.\tab\tab PUMP DOWN\tab FAULT\tab Tracker Frequency Fail\par
7.\tab\tab PUMP DOWN\tab MONITOR\tab 20 Seconds of Pump Down and Pressure Achieved in last 5 seconds.\par
8.\tab\tab PUMP DOWN\tab NRE\tab Battery EOL\par
9.\tab\tab MONITOR\tab SHUT DOWN\tab Long Button Press\par
10.\tab\tab MONITOR\tab FAULT\tab Leak Detected\par
11.\tab\tab MONITOR\tab FAULT\tab Frequency out of range \par
12.\tab\tab MONITOR\tab FAULT\tab Voltage out of range\par
13.\tab\tab MONITOR\tab FAULT\tab NVR Block\par
14.\tab\tab MONITOR \tab NRE\tab Battery Life End\par
15.\tab\tab MONITOR\par
( or any state )\tab NRE\tab Log Buffer Full\par
16.\tab\tab MONITOR \tab Sub-State \par
INDICATE STATUS\tab Short Button Press\par
17.\tab\tab FAULT\tab PUMP DOWN\tab Short Press. \par
18.\tab\tab FAULT\tab PUMP DOWN\tab Long Press. Short press is taken first which transits to long press and then SHUT DOWN\par
19.\tab\tab FAULT\tab PUMP DOWN\tab Fault Time-out 60 minutes\par
20.\tab\tab SHUT DOWN\tab IDLE\tab 3 second timeout\par
21.\tab\tab NRE\tab\tab No exit\par
}
</Description>
      <Notes />
      <ContentValue />
      <ModifiedVersion />
      <HasIssue>false</HasIssue>
      <EntityMappings />
      <FilterTags />
      <ReviewState>Accepted</ReviewState>
    </TraceableEntity>
  </Entities>
</EntityFile>