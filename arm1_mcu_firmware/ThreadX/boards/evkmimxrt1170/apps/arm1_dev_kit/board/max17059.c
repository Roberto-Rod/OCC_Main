/*****************************************************************************/
/**
 * @file 
 *   max17059.c
 * @brief 
 *   API for Maxim MAX17059 fuel gauge
 *
 *****************************************************************************/

/*
 * Copyright (c) 2022 Occuity Ltd. All rights reserved.
 */

/*****************************************************************************/
/* Included Files                                                            */
/*****************************************************************************/

#include <stdint.h>
#include <stdbool.h>

#include "max17059.h"
#include "i2c.h"

/*****************************************************************************/
/* Definitions                                                               */
/*****************************************************************************/

/* I2C slave address */
#define MAX17059_I2C_ID                 (0x6Cu)

/* Register mapping */
#define MAX17059_VCELL                  (0x02u)
#define MAX17059_SOC                    (0x04u)
#define MAX17059_MODE                   (0x06u)
#define MAX17059_VERSION                (0x08u)
#define MAX17059_CONFIG                 (0x0Cu)
#define MAX17059_VRESET                 (0x18u)
#define MAX17059_STATUS                 (0x1Au)
#define MAX17059_TABLE                  (0x40u)
#define MAX17059_CMD                    (0xFEu)

/*****************************************************************************/
/* Type definitions                                                          */
/*****************************************************************************/

/*****************************************************************************/
/* Private (file scope only) variables                                       */
/*****************************************************************************/

/*****************************************************************************/
/* Public (external) variables                                               */
/*****************************************************************************/

/*****************************************************************************/
/* Local functions                                                           */
/*****************************************************************************/

/*****************************************************************************/
/* External interface functions                                              */
/*****************************************************************************/

/**
 * @brief
 *   Initialise the MAX17059 fuel gauge
 */
void MAX17059_initialise(void)
{
    uint8_t version[2];
  
    status_t status = I2C6_receive(
        MAX17059_I2C_ID >> 1u, 
        MAX17059_VERSION, 
        sizeof(uint8_t), 
        version, 
        sizeof(uint16_t));
}

/*** end of file ***/
